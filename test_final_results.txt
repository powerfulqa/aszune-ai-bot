
> aszuneai@1.9.0 test
> jest

PASS __tests__/unit/text-commands-removal.test.js
  Text Commands Removal
    Migration to Slash Commands Only
      âˆš should verify that both handleTextCommand and handleSlashCommand exist (1151 ms)
      âˆš should confirm all text commands have been migrated to slash commands (594 ms)
      âˆš should confirm reminder functionality exists as separate slash commands (561 ms)
      âˆš should verify help command shows updated syntax without text commands (610 ms)

PASS __tests__/unit/services/database-performance.test.js
  DatabaseService - Performance
    getPerformanceMetrics
      âˆš should return empty array when no performance metrics exist (154 ms)
      âˆš should return performance metrics correctly (150 ms)
      âˆš should handle database errors gracefully (130 ms)
    logPerformanceMetric
      âˆš should log performance metrics without throwing (135 ms)
      âˆš should handle database errors gracefully (129 ms)
      âˆš should handle null metadata (130 ms)
      âˆš should handle empty metadata (148 ms)

PASS __tests__/unit/services/database-errors.test.js
  DatabaseService - Errors
    logError
      âˆš should log errors without throwing (136 ms)
      âˆš should handle database errors gracefully (128 ms)
      âˆš should handle null parameters (132 ms)
      âˆš should handle empty context (192 ms)
    getErrorStats
      âˆš should return default stats when no errors logged (128 ms)
      âˆš should aggregate error statistics correctly (140 ms)
      âˆš should handle database errors gracefully (122 ms)

PASS __tests__/unit/services/database-conversations.test.js
  DatabaseService - Conversations
    getConversationHistory
      âˆš should return empty array for non-existent user (123 ms)
      âˆš should return conversation history in chronological order (202 ms)
      âˆš should limit results when limit is specified (442 ms)
      âˆš should handle database errors gracefully (1 ms)
    clearUserData
      âˆš should clear all user data (159 ms)
      âˆš should handle database errors gracefully (1 ms)
    clearAllData
      âˆš should clear all data from all tables (214 ms)
      âˆš should handle database errors gracefully (1 ms)
    clearUserConversationData
      âˆš should clear only conversation data for specific user (177 ms)
      âˆš should handle database errors gracefully (1 ms)

(node:19396) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGINT listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
(node:19396) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGTERM listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
PASS __tests__/unit/main-index-basic.test.js
  Main Index - Basic
    âˆš should export required functions (368 ms)
    âˆš should initialize client properly (180 ms)
    âˆš should have handleChatMessage function (186 ms)
    âˆš should have shutdown function (195 ms)
    âˆš should have error handler functions (180 ms)
    âˆš should handle module loading without errors (178 ms)

  console.log
    [2025-11-24T19:25:38.307Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.359Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.360Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.378Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.379Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.380Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.383Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.384Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.385Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.400Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.400Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.401Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.403Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.404Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.405Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.422Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.423Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.424Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.436Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.437Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.438Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.452Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.452Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.453Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:25:38.486Z] [ERROR] Error in loading cache:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at CacheManager.handleError [as loadCache] (src/services/cache-manager.js:207:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:191:7)

  console.error
    Error: Unexpected token 'i', "invalid json data" is not valid JSON

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at CacheManager.handleError [as loadCache] (src/services/cache-manager.js:207:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:191:7)

  console.error
    Stack: SyntaxError: Unexpected token 'i', "invalid json data" is not valid JSON
        at JSON.parse (<anonymous>)
        at CacheManager.parse [as loadCache] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\cache-manager.js:201:19)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-advanced.test.js:191:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at CacheManager.handleError [as loadCache] (src/services/cache-manager.js:207:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:191:7)

  console.warn
    [2025-11-24T19:25:38.506Z] [WARN] Cache load error: An unexpected error occurred. Please try again later.

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at CacheManager.warn [as loadCache] (src/services/cache-manager.js:208:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:191:7)

  console.error
    [2025-11-24T19:25:38.510Z] [ERROR] Error in saving cache:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at CacheManager.handleError [as saveCache] (src/services/cache-manager.js:229:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:192:7)

  console.error
    Error: Cache write error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at CacheManager.handleError [as saveCache] (src/services/cache-manager.js:229:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:192:7)

  console.error
    Stack: Error: Cache write error
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-advanced.test.js:120:38)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at CacheManager.handleError [as saveCache] (src/services/cache-manager.js:229:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:192:7)

  console.error
    [2025-11-24T19:25:38.517Z] [ERROR] Cache save error: An unexpected error occurred. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at CacheManager.error [as saveCache] (src/services/cache-manager.js:230:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:192:7)

  console.log
    [2025-11-24T19:25:38.520Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.521Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:38.523Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:25:38.524Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:210:22)

  console.error
    Error: Temporary network error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:210:22)

  console.error
    [2025-11-24T19:25:38.554Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:210:22)

  console.error
    Error: Request failed: Temporary network error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:210:22)

  console.error
    Stack: Error: Request failed: Temporary network error
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at ResponseProcessor.generateResponseWithRetry (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\response-processor.js:135:14)
        at PerplexityService._processChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:673:22)
        at PerplexityService.generateChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:734:23)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-advanced.test.js:210:22)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:210:22)

  console.error
    [2025-11-24T19:25:38.566Z] [ERROR] API request failed: An unexpected error occurred. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:210:22)

  console.error
    [2025-11-24T19:25:38.568Z] [ERROR] Error in API retry:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at ResponseProcessor.handleError [as generateResponseWithRetry] (src/services/response-processor.js:141:22)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:210:22)

  console.error
    Error: Request failed: Temporary network error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at ResponseProcessor.handleError [as generateResponseWithRetry] (src/services/response-processor.js:141:22)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:210:22)

  console.error
    Stack: Error: Request failed: Temporary network error
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at ResponseProcessor.generateResponseWithRetry (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\response-processor.js:135:14)
        at PerplexityService._processChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:673:22)
        at PerplexityService.generateChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:734:23)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-advanced.test.js:210:22)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at ResponseProcessor.handleError [as generateResponseWithRetry] (src/services/response-processor.js:141:22)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:210:22)

  console.log
    [2025-11-24T19:25:39.575Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:39.576Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:39.576Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:39.592Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:39.592Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:39.593Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:25:39.594Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:223:7)

  console.error
    Error: Permanent API error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:223:7)

  console.error
    [2025-11-24T19:25:39.598Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:223:7)

  console.error
    Error: Request failed: Permanent API error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:223:7)

  console.error
    Stack: Error: Request failed: Permanent API error
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at ResponseProcessor.generateResponseWithRetry (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\response-processor.js:135:14)
        at PerplexityService._processChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:673:22)
        at PerplexityService.generateChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:734:23)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-advanced.test.js:223:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:223:7)

  console.error
    [2025-11-24T19:25:39.606Z] [ERROR] API request failed: The service is temporarily unavailable. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:223:7)

  console.error
    [2025-11-24T19:25:39.621Z] [ERROR] Error in generate chat response:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:223:7)

  console.error
    Error: Request failed: Permanent API error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:223:7)

  console.error
    Stack: Error: Request failed: Permanent API error
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at ResponseProcessor.generateResponseWithRetry (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\response-processor.js:135:14)
        at PerplexityService._processChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:673:22)
        at PerplexityService.generateChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:734:23)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-advanced.test.js:223:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:223:7)

  console.error
    [2025-11-24T19:25:39.626Z] [ERROR] Failed to generate chat response: The service is temporarily unavailable. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as generateChatResponse] (src/services/perplexity-secure.js:765:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:223:7)

  console.log
    [2025-11-24T19:25:39.629Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:39.630Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:39.631Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:25:39.632Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:238:22)

  console.error
    Error: Request timeout

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:238:22)

  console.error
    [2025-11-24T19:25:39.636Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:238:22)

  console.error
    Error: Request failed: Request timeout

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:238:22)

  console.error
    Stack: Error: Request failed: Request timeout
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at ResponseProcessor.generateResponseWithRetry (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\response-processor.js:135:14)
        at PerplexityService._processChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:673:22)
        at PerplexityService.generateChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:734:23)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-advanced.test.js:238:22)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:238:22)

  console.error
    [2025-11-24T19:25:39.644Z] [ERROR] API request failed: An unexpected error occurred. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:238:22)

  console.error
    [2025-11-24T19:25:39.646Z] [ERROR] Error in API retry:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at ResponseProcessor.handleError [as generateResponseWithRetry] (src/services/response-processor.js:141:22)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:238:22)

  console.error
    Error: Request failed: Request timeout

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at ResponseProcessor.handleError [as generateResponseWithRetry] (src/services/response-processor.js:141:22)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:238:22)

  console.error
    Stack: Error: Request failed: Request timeout
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at ResponseProcessor.generateResponseWithRetry (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\response-processor.js:135:14)
        at PerplexityService._processChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:673:22)
        at PerplexityService.generateChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:734:23)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-advanced.test.js:238:22)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at ResponseProcessor.handleError [as generateResponseWithRetry] (src/services/response-processor.js:141:22)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-advanced.test.js:238:22)

  console.log
    [2025-11-24T19:25:40.664Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:40.665Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:40.665Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

PASS __tests__/unit/services/perplexity-secure-advanced.test.js
  PerplexitySecure Service - Advanced
    question caching
      âˆš should cache questions and return cached responses (76 ms)
      âˆš should not cache when caching is disabled (19 ms)
      âˆš should handle cache file read errors gracefully (19 ms)
      âˆš should handle cache file write errors gracefully (14 ms)
      âˆš should handle corrupted cache data (15 ms)
    file permission security
      âˆš should handle file permission errors gracefully (15 ms)
      âˆš should create cache directory with proper permissions (53 ms)
    retry mechanism
      âˆš should retry on temporary failures (1071 ms)
      âˆš should not retry on permanent failures (37 ms)
      âˆš should handle timeout errors (1051 ms)

PASS __tests__/unit/services/database-uptime.test.js
  DatabaseService - Uptime
    logBotEvent
      âˆš should record uptime without throwing (137 ms)
      âˆš should handle database errors gracefully (130 ms)
      âˆš should handle zero uptime (145 ms)
      âˆš should handle negative uptime (129 ms)
    getUptimeStats
      âˆš should return default uptime stats when no data exists (136 ms)
      âˆš should calculate uptime statistics correctly (143 ms)
      âˆš should handle database errors gracefully (128 ms)

(node:19396) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGINT listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:19396) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGTERM listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
PASS __tests__/unit/main-index-advanced.test.js
  Main Index - Advanced
    âˆš should handle bootWithOptimizations function (196 ms)
    âˆš should handle registerSlashCommands function (171 ms)
    âˆš should handle Pi optimization detection (1 ms)
    âˆš should handle enhanced cache initialization (1 ms)
    âˆš should handle perplexity service initialization (1 ms)
    âˆš should handle error scenarios gracefully (178 ms)
    âˆš should handle multiple imports without conflicts (167 ms)
    âˆš should handle environment variable changes (174 ms)
    âˆš should handle missing dependencies gracefully (168 ms)

  console.warn
    [2025-11-24T19:25:44.602Z] [WARN] Invalid user ID: Invalid user ID format

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at warn (src/services/chat.js:88:12)
      at processUserMessage (src/services/chat.js:375:33)
      at Object.chatService (__tests__/unit/chat-error-branches.test.js:123:28)

  console.error
    [2025-11-24T19:25:45.005Z] [ERROR] Error in processAIResponse:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:159:7)

  console.error
    Error: Timeout

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:159:7)

  console.error
    Stack: Error: Timeout
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\chat-error-branches.test.js:151:28)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:159:7)

  console.error
    [2025-11-24T19:25:45.245Z] [ERROR] Error in processAIResponse:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:184:7)

  console.error
    Error: Rate limited

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:184:7)

  console.error
    Stack: Error: Rate limited
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\chat-error-branches.test.js:176:30)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:184:7)

  console.error
    [2025-11-24T19:25:45.443Z] [ERROR] Error in processAIResponse:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:209:7)

  console.error
    Error: Service error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:209:7)

  console.error
    Stack: Error: Service error
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\chat-error-branches.test.js:201:24)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:209:7)

  console.error
    [2025-11-24T19:25:46.050Z] [ERROR] Error in processAIResponse:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:258:7)

  console.error
    Error: Emoji error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:258:7)

  console.error
    Stack: Error: Emoji error
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\chat-error-branches.test.js:255:64)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:258:7)

  console.error
    [2025-11-24T19:25:46.235Z] [ERROR] Error in processAIResponse:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:273:7)

  console.error
    Error: Service error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:273:7)

  console.error
    Stack: Error: Service error
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\chat-error-branches.test.js:267:68)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:273:7)

  console.error
    [2025-11-24T19:25:46.433Z] [ERROR] Error in processAIResponse:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:288:7)

  console.error
    Error: Chunking error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:288:7)

  console.error
    Stack: Error: Chunking error
        at C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\chat-error-branches.test.js:281:15
        at C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-mock\build\index.js:397:39
        at C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-mock\build\index.js:404:13
        at mockConstructor (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-mock\build\index.js:148:19)
        at chunkMessage (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\chat.js:520:20)
        at handleChatMessage (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\chat.js:395:5)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\chat-error-branches.test.js:288:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-error-branches.test.js:288:7)

PASS __tests__/unit/chat-error-branches.test.js
  Chat Service - Error Handling Branch Coverage
    Input Validation Error Branches
      âˆš should handle invalid input validation (160 ms)
      âˆš should handle input validation exceptions (181 ms)
    AI Service Error Branches
      âˆš should handle timeout errors (233 ms)
      âˆš should handle rate limit errors (224 ms)
      âˆš should handle generic API errors (197 ms)
    Pi Optimization Branch Coverage
      âˆš should skip emoji processing in low CPU mode (196 ms)
      âˆš should process emojis when not in low CPU mode (201 ms)
      âˆš should handle emoji processing errors gracefully (209 ms)
    Message Formatting Error Branches
      âˆš should handle message formatting errors (185 ms)
      âˆš should handle chunking errors (213 ms)

PASS __tests__/unit/services/perplexity-secure-private-methods.test.js
  PerplexitySecure Service - Private Methods
    _safeGetHeader method
      âˆš should return empty string for null headers (2 ms)
      âˆš should return empty string for undefined headers (1 ms)
      âˆš should return empty string for null key
      âˆš should get header using Headers.get() method (2 ms)
      âˆš should fall back to object property access
      âˆš should check lowercase header names
      âˆš should check uppercase header names
      âˆš should handle Headers.get() throwing error
      âˆš should handle non-object headers
      âˆš should handle function headers (1 ms)
    _shouldUseCache method
      âˆš should return false when caching is explicitly disabled
      âˆš should return true when in test environment
      âˆš should return true when cache is enabled and caching not disabled (1 ms)
    _buildRequestPayload method
      âˆš should build basic request payload with defaults (1 ms)
      âˆš should use custom options when provided (1 ms)
    _getPiOptimizationSettings method
      âˆš should return default settings when PI_OPTIMIZATIONS is not configured (4 ms)
      âˆš should return settings from config when available (1 ms)
      âˆš should handle config access errors gracefully (3 ms)
    _generateCacheKey method
      âˆš should generate consistent cache key for same history
      âˆš should generate different keys for different history (1 ms)
    _formatCacheEntry method
      âˆš should format string entry with timestamp
      âˆš should preserve existing object entry with timestamp (1 ms)
      âˆš should add timestamp to object entry without one
      âˆš should handle null entry (1 ms)
    _isRetryableError method
      âˆš should return false for null error (1 ms)
      âˆš should return false for error without message (1 ms)
      âˆš should return true for temporary errors
      âˆš should return true for network errors (1 ms)
      âˆš should return true for 429 errors
      âˆš should return false for permanent errors
      âˆš should return false for invalid errors (1 ms)
      âˆš should return false for unauthorized errors
      âˆš should return false for forbidden errors
      âˆš should return false for unknown errors by default (1 ms)

PASS __tests__/unit/reminder-service.test.js
  ReminderService
    initialize
      âˆš should initialize successfully (3 ms)
      âˆš should not initialize twice (1 ms)
      âˆš should handle initialization errors (19 ms)
    loadAndScheduleReminders
      âˆš should load and schedule active reminders (1 ms)
      âˆš should handle errors during loading (1 ms)
    scheduleReminder
      âˆš should complete past due reminders immediately (1 ms)
      âˆš should schedule future reminders with setTimeout (3 ms)
      âˆš should schedule long-term reminders with interval check (1 ms)
      âˆš should clear existing timer before scheduling new one (1 ms)
      âˆš should handle scheduling errors (5 ms)
    executeReminder
      âˆš should execute reminder successfully
      âˆš should not emit if database completion fails
      âˆš should handle execution errors (1 ms)
    createReminder
      âˆš should create and schedule a reminder (1 ms)
      âˆš should validate scheduled time format (1 ms)
      âˆš should validate future time
      âˆš should handle database creation failure
      âˆš should handle errors (1 ms)
    cancelReminder
      âˆš should cancel existing reminder
      âˆš should return false if reminder not found (1 ms)
      âˆš should handle errors
    setReminder
      âˆš should parse "in X minutes" format (148 ms)
      âˆš should parse "in X hours" format (240 ms)
      âˆš should parse "tomorrow" format (107 ms)
      âˆš should throw on unsupported format (108 ms)
      âˆš should handle errors (105 ms)
    deleteReminder
      âˆš should delete reminder and clear timer (1 ms)
      âˆš should return false if delete fails (1 ms)
      âˆš should handle errors (1 ms)
    Event Emitter
      âˆš should register and emit events (1 ms)
      âˆš should handle listener errors gracefully (1 ms)
    getUserReminders
      âˆš should delegate to database service

PASS __tests__/unit/services/perplexity-secure-error.test.js
  PerplexitySecure Service - Error Handling
    _handleErrorResponse method
      âˆš should handle error response with text body (36 ms)
      âˆš should handle error response without body (3 ms)
      âˆš should handle body text error (1 ms)
      âˆš should handle long error messages (1 ms)
    _generateErrorMessage method
      âˆš should return rate limit message for 429 status (1 ms)
      âˆš should return service unavailable message for 5xx status
      âˆš should return network error message for network errors (1 ms)
      âˆš should return empty response message for empty response errors
      âˆš should return unexpected format message for invalid errors
      âˆš should return original error message for unknown errors (1 ms)
    _isRetryableError method
      âˆš should return false for null error
      âˆš should return false for error without message (1 ms)
      âˆš should return true for temporary errors
      âˆš should return true for network errors
      âˆš should return true for 429 errors (1 ms)
      âˆš should return false for permanent errors
      âˆš should return false for invalid errors (1 ms)
      âˆš should return false for unauthorized errors
      âˆš should return false for forbidden errors (1 ms)
      âˆš should return false for unknown errors by default

PASS __tests__/unit/natural-language-reminder.test.js
  Natural Language Reminder Processor
    isReminderRequest
      âˆš should detect explicit reminder requests (34 ms)
      âˆš should not detect non-reminder messages (2 ms)
    extractEvent
      âˆš should extract event from reminder requests (3 ms)
      âˆš should return null for messages without clear events (3 ms)
    processReminderRequest
      âˆš should process valid reminder requests (3 ms)
      âˆš should handle messages without extractable events (3 ms)
    extractDatesFromResponse
      âˆš should extract dates from AI responses (5 ms)
      âˆš should handle responses without dates (3 ms)
    lookupAndSetReminder integration
      âˆš should successfully set reminder when date is found (319 ms)
      âˆš should handle cases where no date is found (16 ms)

  console.error
    [2025-11-24T19:25:53.398Z] [ERROR] Error in extracting response content:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as _extractResponseContent] (src/services/perplexity-secure.js:446:42)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-comprehensive.test.js:454:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-comprehensive.test.js:454:69)

  console.error
    Error: Empty response received from the service.

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as _extractResponseContent] (src/services/perplexity-secure.js:446:42)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-comprehensive.test.js:454:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-comprehensive.test.js:454:69)

  console.error
    Stack: Error: Empty response received from the service.
        at PerplexityService._extractResponseContent (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:424:15)
        at _extractResponseContent (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-comprehensive.test.js:454:38)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\expect\build\toThrowMatchers.js:74:11)
        at Object.throwingMatcher [as toThrow] (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\expect\build\index.js:320:21)
        at Object.toThrow (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-comprehensive.test.js:454:69)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as _extractResponseContent] (src/services/perplexity-secure.js:446:42)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-comprehensive.test.js:454:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-comprehensive.test.js:454:69)

  console.warn
    [2025-11-24T19:25:53.427Z] [WARN] Response processing error: An unexpected error occurred. Please try again later.

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at PerplexityService.warn [as _extractResponseContent] (src/services/perplexity-secure.js:447:14)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-comprehensive.test.js:454:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-comprehensive.test.js:454:69)

  console.error
    [2025-11-24T19:25:53.432Z] [ERROR] Error in extracting response content:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as _extractResponseContent] (src/services/perplexity-secure.js:446:42)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-comprehensive.test.js:459:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-comprehensive.test.js:459:73)

  console.error
    Error: Empty response received from the service.

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as _extractResponseContent] (src/services/perplexity-secure.js:446:42)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-comprehensive.test.js:459:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-comprehensive.test.js:459:73)

  console.error
    Stack: Error: Empty response received from the service.
        at PerplexityService._extractResponseContent (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:429:15)
        at _extractResponseContent (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-comprehensive.test.js:459:38)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\expect\build\toThrowMatchers.js:74:11)
        at Object.throwingMatcher [as toThrow] (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\expect\build\index.js:320:21)
        at Object.toThrow (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-comprehensive.test.js:459:73)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as _extractResponseContent] (src/services/perplexity-secure.js:446:42)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-comprehensive.test.js:459:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-comprehensive.test.js:459:73)

  console.warn
    [2025-11-24T19:25:53.438Z] [WARN] Response processing error: An unexpected error occurred. Please try again later.

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at PerplexityService.warn [as _extractResponseContent] (src/services/perplexity-secure.js:447:14)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-comprehensive.test.js:459:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-comprehensive.test.js:459:73)

  console.log
    [2025-11-24T19:25:53.462Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=256

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:53.463Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:53.464Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:53.466Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=256

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:53.467Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:25:53.467Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:25:53.468Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at PerplexityService.generateTextSummary (src/services/perplexity-secure.js:980:22)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-comprehensive.test.js:741:7)

  console.error
    Error: Summary API error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at PerplexityService.generateTextSummary (src/services/perplexity-secure.js:980:22)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-comprehensive.test.js:741:7)

  console.error
    [2025-11-24T19:25:53.475Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at PerplexityService.generateTextSummary (src/services/perplexity-secure.js:980:22)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-comprehensive.test.js:741:7)

  console.error
    Error: Request failed: Summary API error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at PerplexityService.generateTextSummary (src/services/perplexity-secure.js:980:22)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-comprehensive.test.js:741:7)

  console.error
    Stack: Error: Request failed: Summary API error
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at PerplexityService.generateTextSummary (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:980:22)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-comprehensive.test.js:741:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at PerplexityService.generateTextSummary (src/services/perplexity-secure.js:980:22)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-comprehensive.test.js:741:7)

  console.error
    [2025-11-24T19:25:53.480Z] [ERROR] API request failed: The service is temporarily unavailable. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at PerplexityService.generateTextSummary (src/services/perplexity-secure.js:980:22)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-comprehensive.test.js:741:7)

  console.error
    [2025-11-24T19:25:53.483Z] [ERROR] Error in getting cache statistics:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as getCacheStats] (src/services/perplexity-secure.js:112:42)
      at Object.getCacheStats (__tests__/unit/services/perplexity-secure-comprehensive.test.js:772:40)

  console.error
    Error: Cache error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as getCacheStats] (src/services/perplexity-secure.js:112:42)
      at Object.getCacheStats (__tests__/unit/services/perplexity-secure-comprehensive.test.js:772:40)

  console.error
    Stack: Error: Cache error
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-comprehensive.test.js:768:17)
        at C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-mock\build\index.js:397:39
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-mock\build\index.js:404:13)
        at Object.mockConstructor [as getStats] (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-mock\build\index.js:148:19)
        at PerplexityService.getStats [as getCacheStats] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:110:32)
        at Object.getCacheStats (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-comprehensive.test.js:772:40)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as getCacheStats] (src/services/perplexity-secure.js:112:42)
      at Object.getCacheStats (__tests__/unit/services/perplexity-secure-comprehensive.test.js:772:40)

  console.warn
    [2025-11-24T19:25:53.490Z] [WARN] Cache statistics error: An unexpected error occurred. Please try again later.

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at PerplexityService.warn [as getCacheStats] (src/services/perplexity-secure.js:113:14)
      at Object.getCacheStats (__tests__/unit/services/perplexity-secure-comprehensive.test.js:772:40)

  console.log
    [2025-11-24T19:25:53.494Z] [INFO] Final cache statistics:

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    {
      hits: 0,
      misses: 0,
      sets: 0,
      deletes: 0,
      evictions: 0,
      hitRate: 0,
      entryCount: 0,
      memoryUsage: 0,
      memoryUsageFormatted: '0 B',
      maxMemory: 0,
      maxMemoryFormatted: '0 B',
      maxSize: 0,
      uptime: 0,
      uptimeFormatted: '0s',
      evictionStrategy: 'hybrid',
      error: 'An unexpected error occurred. Please try again later.'
    }

      at Logger.log [as info] (src/utils/logger.js:153:25)

  console.log
    [2025-11-24T19:25:53.496Z] [INFO] Final cache statistics:

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    {
      hits: 0,
      misses: 0,
      sets: 0,
      deletes: 0,
      evictions: 0,
      hitRate: 0,
      entryCount: 0,
      memoryUsage: 0,
      memoryUsageFormatted: '0 B',
      maxMemory: 0,
      maxMemoryFormatted: '0 B',
      maxSize: 0,
      uptime: 0,
      uptimeFormatted: '0s',
      evictionStrategy: 'hybrid',
      error: 'An unexpected error occurred. Please try again later.'
    }

      at Logger.log [as info] (src/utils/logger.js:153:25)

PASS __tests__/unit/services/perplexity-secure-comprehensive.test.js
  PerplexitySecure Service - Comprehensive Coverage
    _safeGetHeader method
      âˆš should return empty string for null headers (2 ms)
      âˆš should return empty string for undefined headers (1 ms)
      âˆš should return empty string for null key
      âˆš should get header using Headers.get() method (2 ms)
      âˆš should fall back to object property access
      âˆš should check lowercase header names
      âˆš should check uppercase header names
      âˆš should handle Headers.get() throwing error
      âˆš should handle non-object headers
      âˆš should handle function headers (1 ms)
    _shouldUseCache method
      âˆš should return false when caching is explicitly disabled
      âˆš should return true when in test environment (1 ms)
      âˆš should return true when cache is enabled and caching not disabled
    _buildRequestPayload method
      âˆš should build basic request payload with defaults (1 ms)
      âˆš should use custom options when provided
      âˆš should handle streaming when PI optimizations enabled (1 ms)
      âˆš should not enable streaming in low CPU mode (1 ms)
    _getPiOptimizationSettings method
      âˆš should return default settings when PI_OPTIMIZATIONS is not configured (4 ms)
      âˆš should return settings from config when available
      âˆš should handle config access errors gracefully (3 ms)
    _handleApiResponse method
      âˆš should throw error for null response (48 ms)
      âˆš should throw error for undefined response (1 ms)
      âˆš should handle error status codes (1 ms)
      âˆš should handle response without body
      âˆš should handle body without json method (1 ms)
      âˆš should handle JSON parsing errors (1 ms)
      âˆš should handle invalid response object (1 ms)
      âˆš should handle missing choices array (1 ms)
      âˆš should handle invalid choice structure
      âˆš should handle missing message field (1 ms)
      âˆš should return valid response data
    _handleErrorResponse method
      âˆš should handle error response with text body (1 ms)
      âˆš should handle error response without body (1 ms)
      âˆš should handle body text error (1 ms)
      âˆš should handle long error messages
    _extractResponseContent method
      âˆš should extract content from message.content (1 ms)
      âˆš should extract content from choice.content
      âˆš should handle empty response (35 ms)
      âˆš should handle empty choices (9 ms)
      âˆš should return default message for invalid structure
    _generateErrorMessage method
      âˆš should return rate limit message for 429 status
      âˆš should return service unavailable message for 5xx status (1 ms)
      âˆš should return network error message for network errors
      âˆš should return empty response message for empty response errors (1 ms)
      âˆš should return unexpected format message for invalid errors
      âˆš should return original error message for unknown errors
    _isRetryableError method
      âˆš should return false for null error
      âˆš should return false for error without message
      âˆš should return true for temporary errors (1 ms)
      âˆš should return true for network errors
      âˆš should return true for 429 errors (1 ms)
      âˆš should return false for permanent errors
      âˆš should return false for invalid errors
      âˆš should return false for unauthorized errors (1 ms)
      âˆš should return false for forbidden errors (3 ms)
      âˆš should return false for unknown errors by default
    _getCacheConfiguration method
      âˆš should return default config when PI_OPTIMIZATIONS not configured (3 ms)
      âˆš should return cache config when PI optimizations enabled
      âˆš should handle config access errors (4 ms)
    _formatCacheEntry method
      âˆš should format string entry with timestamp (1 ms)
      âˆš should preserve existing object entry with timestamp
      âˆš should add timestamp to object entry without one (1 ms)
      âˆš should handle null entry
    _generateCacheKey method
      âˆš should generate consistent cache key for same history
      âˆš should generate different keys for different history
    generateTextSummary method
      âˆš should generate text summary with correct options (5 ms)
      âˆš should handle text summary errors (15 ms)
    getCacheStats method
      âˆš should return cache stats when available (1 ms)
      âˆš should return error stats when cache throws (11 ms)
      âˆš should handle missing cache gracefully
    shutdown method
      âˆš should clear all active intervals (3 ms)
      âˆš should handle shutdown when no intervals exist (2 ms)

PASS __tests__/unit/commands/dashboard.test.js
  Dashboard Command
    âˆš should handle dashboard command successfully (4 ms)
    âˆš should handle dashboard command error
    âˆš should handle dashboard with degraded performance

PASS __tests__/unit/input-validator-userid.test.js
  InputValidator - User ID
    validateUserId
      âˆš should validate correct Discord user IDs (3 ms)
      âˆš should reject invalid user IDs (2 ms)
      âˆš should accept valid user IDs (2 ms)
      âˆš should handle edge cases

PASS __tests__/unit/services/database-reminders.test.js
  DatabaseService - Reminders
    createReminder
      âˆš should create a reminder and return reminder object (144 ms)
      âˆš should handle database errors gracefully (1 ms)
    getActiveReminders
      âˆš should return empty array when no reminders exist (141 ms)
      âˆš should return active reminders for user (155 ms)
      âˆš should not return completed reminders (152 ms)
      âˆš should handle database errors gracefully (1 ms)
    getDueReminders
      âˆš should return empty array when no due reminders (130 ms)
      âˆš should return reminders that are due (150 ms)
      âˆš should handle database errors gracefully (1 ms)
    completeReminder
      âˆš should mark reminder as completed (151 ms)
      âˆš should return false for non-existent reminder (135 ms)
      âˆš should handle database errors gracefully (1 ms)
    cancelReminder
      âˆš should mark reminder as cancelled (155 ms)
      âˆš should return false for non-existent reminder (135 ms)
      âˆš should handle database errors gracefully (1 ms)
    getUserReminders
      âˆš should return all reminders for user regardless of status (155 ms)
      âˆš should return empty array for user with no reminders (127 ms)
      âˆš should handle database errors gracefully (1 ms)
    deleteReminder
      âˆš should permanently delete reminder (150 ms)
      âˆš should return false for non-existent reminder (131 ms)
      âˆš should handle database errors gracefully (1 ms)

PASS __tests__/unit/emoji-manager.test.js
  EmojiManager
    âˆš adds emojis to response based on keywords (3 ms)
    âˆš adds multiple emojis when multiple keywords are found (1 ms)
    âˆš does not add emojis when no keywords are found (1 ms)
    âˆš gets reactions for a message based on keywords (1 ms)
    âˆš returns empty array when no reaction keywords are found (1 ms)
    âˆš adds reactions to a message (2 ms)
    âˆš handles errors when adding reactions (8 ms)

PASS __tests__/unit/enhanced-cache-ttl.test.js
  EnhancedCache - TTL
    TTL (Time To Live)
      âˆš should respect default TTL (3 ms)
      âˆš should respect custom TTL (1 ms)
      âˆš should not expire before TTL
      âˆš should handle zero TTL (immediate expiration) (1 ms)

PASS __tests__/unit/services/database-reminder-stats.test.js
  DatabaseService - Reminder Statistics
    getUserReminderCount
      âˆš should return 0 for user with no reminders (156 ms)
      âˆš should return correct count of active reminders for user (193 ms)
      âˆš should not count cancelled reminders (193 ms)
      âˆš should return 0 when database is disabled (1 ms)
      âˆš should handle database errors gracefully (146 ms)
    getReminderStats
      âˆš should return default stats when no reminders exist (140 ms)
      âˆš should return correct stats with mixed reminder statuses (221 ms)
      âˆš should handle stats with only active reminders (166 ms)
      âˆš should return default stats when database is disabled (1 ms)
      âˆš should handle database errors gracefully (286 ms)
    Helper Methods
      âˆš should return correct default reminder stats from _getDefaultReminderStats (1 ms)
      âˆš should correctly map status counts with _mapStatusCounts (1 ms)
      âˆš should handle unknown status in _mapStatusCounts (1 ms)

PASS __tests__/integration/bot-edge-cases-basic.test.js
  Bot Edge Cases - Basic
    âˆš should handle empty messages (3 ms)
    âˆš should handle messages with only whitespace
    âˆš should handle very long messages (1 ms)
    âˆš should handle messages with special characters (1 ms)
    âˆš should handle messages with unicode characters
    âˆš should handle messages with newlines
    âˆš should handle messages with tabs
    âˆš should handle messages with carriage returns (1 ms)

PASS __tests__/unit/utils/performance-tracker-reports.test.js
  PerformanceTracker - Reporting
    generatePerformanceReport
      âˆš should generate comprehensive performance report (4 ms)
      âˆš should generate recommendations for poor performance (1 ms)
      âˆš should generate positive recommendations for good performance (1 ms)
      âˆš should detect slow operations issue
      âˆš should detect memory leak warning (1 ms)
    _calculateBasicMetrics
      âˆš should calculate metrics correctly (1 ms)
      âˆš should count slow operations correctly
    _analyzeMemoryTrend
      âˆš should return insufficient_data for small datasets (1 ms)
    _generateRecommendations
      âˆš should recommend optimization for slow responses
      âˆš should recommend error investigation for low success rate (1 ms)
      âˆš should recommend memory leak investigation (1 ms)

PASS __tests__/unit/commands/resources.test.js
  Resources Command
    âˆš should handle resources command successfully (11 ms)
    âˆš should handle resources command error (1 ms)
    âˆš should handle resources with warning status (1 ms)

PASS __tests__/unit/commands-analytics.test.js
  Commands - Analytics Commands
    /analytics command
      âˆš should handle /analytics command successfully (5 ms)
      âˆš should handle /analytics command with API timeout fallback (2 ms)
    /dashboard command
      âˆš should handle /dashboard command successfully (8 ms)
      âˆš should handle /dashboard command with critical alerts (6 ms)
    /resources command
      âˆš should handle /resources command successfully (6 ms)
      âˆš should handle /resources command with warning status (4 ms)

PASS __tests__/unit/enhanced-cache-basic.test.js
  EnhancedCache - Basic Operations
    Basic Operations
      âˆš should set and get values (3 ms)
      âˆš should return null for non-existent keys (1 ms)
      âˆš should check if key exists by getting it
      âˆš should delete keys (1 ms)
      âˆš should clear all entries (1 ms)
      âˆš should handle different value types (1 ms)
      âˆš should update existing keys (1 ms)

PASS __tests__/unit/index-critical-coverage.test.js
  index.js - Critical Coverage Enhancement
    Production Environment with Pi Optimizations
      âˆš should initialize Pi optimizations in production environment (21 ms)
      âˆš should handle Pi optimization initialization errors gracefully (17 ms)
    Development Environment
      âˆš should not initialize Pi optimizations in development (18 ms)
    Discord Client Event Handlers
      âˆš should handle ready event and register slash commands (21 ms)
      âˆš should handle slash command registration errors (20 ms)
      âˆš should handle client not ready during slash command registration (17 ms)
      âˆš should handle error events (21 ms)
      âˆš should handle warn events (20 ms)
      âˆš should handle interaction events (18 ms)
      âˆš should ignore non-slash interactions (23 ms)
    Shutdown Error Scenarios
      âˆš should handle conversation manager shutdown errors (96 ms)
      âˆš should handle Discord client shutdown errors (56 ms)
      âˆš should not duplicate shutdown when already in progress (57 ms)
      âˆš should handle multiple shutdown errors and exit with code 1 (53 ms)
    Login Error Handling
      âˆš should handle Discord login failures in production (19 ms)
      âˆš should handle Discord login failures in test mode (21 ms)
    bootWithOptimizations Error Branches
      âˆš should handle Pi optimization errors in bootWithOptimizations (1 ms)
      âˆš should skip Pi optimizations when disabled (1 ms)
      âˆš should skip Pi optimizations when config is null

PASS __tests__/unit/conversation-rate-limiting.test.js
  ConversationManager - Rate Limiting and Validation
    Rate Limiting Advanced Scenarios
      âˆš should handle rate limiting with custom windows (3 ms)
      âˆš should handle multiple users with different rate limit states (1 ms)
    Input Validation Edge Cases
      âˆš should handle invalid user ID in getHistory (2 ms)
      âˆš should handle invalid user ID in addMessage (1 ms)
      âˆš should handle invalid message content
      âˆš should handle invalid role in addMessage (1 ms)
      âˆš should accept valid roles
    User Statistics Edge Cases
      âˆš should initialize user stats for new users
      âˆš should update message count correctly (1 ms)
      âˆš should handle invalid stat types gracefully

PASS __tests__/unit/services/database-basic.test.js
  DatabaseService - Basic Operations
    constructor
      âˆš should initialize database service (4 ms)
      âˆš should handle database initialization errors gracefully (1 ms)
    getDb
      âˆš should return the database instance (142 ms)
      âˆš should return mock database when database is disabled (2 ms)
    initTables
      âˆš should create all required tables (156 ms)
      âˆš should handle table creation errors gracefully (2 ms)

PASS __tests__/unit/services/database-core.test.js
  DatabaseService - Core
    constructor
      âˆš should initialize without accessing config (3 ms)
    getDb
      âˆš should initialize database on first call and create tables (150 ms)
      âˆš should return same db on subsequent calls (139 ms)
    initTables
      âˆš should create tables when called (141 ms)
    close
      âˆš should close database connection (146 ms)
      âˆš should handle close when db is not initialized (2 ms)
    clearAllData
      âˆš should clear all data from all tables (241 ms)

PASS __tests__/unit/url-formatter-social.test.js
  URL Formatter - Social Media
    formatSocialMediaLinks
      âˆš should format Reddit URLs (2 ms)
      âˆš should format Reddit subreddit references (1 ms)
      âˆš should format Imgur URLs
      âˆš should format GitHub URLs
      âˆš should format Twitter URLs (1 ms)
      âˆš should format X.com URLs
      âˆš should handle text without URLs (1 ms)
      âˆš should handle multiple URLs in one text (1 ms)
      âˆš should handle URLs with query parameters
      âˆš should handle URLs with fragments (1 ms)
      âˆš should handle URLs with www prefix
      âˆš should handle URLs with https prefix (1 ms)
      âˆš should handle URLs with http prefix (1 ms)
      âˆš should handle mixed case URLs
      âˆš should handle URLs at end of sentence (1 ms)
      âˆš should handle URLs at beginning of sentence

  console.warn
    [2025-11-24T19:26:22.989Z] [WARN] Database operation error: SQLite3 can only bind numbers, strings, bigints, buffers, and null

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _executeSql] (src/services/database.js:59:14)
      at DatabaseService._executeSql [as logError] (src/services/database.js:418:17)
      at Object.logError (__tests__/unit/services/database-analytics.test.js:190:17)

  console.warn
    [2025-11-24T19:26:23.015Z] [WARN] Database operation error: SQLite3 can only bind numbers, strings, bigints, buffers, and null

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _executeSql] (src/services/database.js:59:14)
      at DatabaseService._executeSql [as logError] (src/services/database.js:418:17)
      at logError (__tests__/unit/services/database-analytics.test.js:193:30)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/database-analytics.test.js:193:76)

PASS __tests__/unit/services/database-analytics.test.js
  DatabaseService - Analytics
    ensureUserExists
      âˆš should create user if they do not exist (161 ms)
      âˆš should not modify existing user (147 ms)
      âˆš should handle database errors gracefully (1 ms)
    trackCommandUsage
      âˆš should track command usage (181 ms)
      âˆš should handle database errors gracefully (1 ms)
    getCommandUsageStats
      âˆš should return command usage statistics (156 ms)
      âˆš should handle database errors gracefully (2 ms)
    logPerformanceMetric
      âˆš should log performance metrics (151 ms)
      âˆš should handle database errors gracefully (1 ms)
    getPerformanceMetrics
      âˆš should return performance metrics for type (170 ms)
      âˆš should limit results when specified (202 ms)
      âˆš should handle database errors gracefully (1 ms)
    logError
      âˆš should log errors (166 ms)
      âˆš should handle database errors gracefully (2 ms)
    getErrorStats
      âˆš should return error statistics (134 ms)
      âˆš should handle database errors gracefully (1 ms)
    getUptimeStats
      âˆš should return uptime statistics (134 ms)
      âˆš should handle database errors gracefully (1 ms)

PASS __tests__/unit/commands/analytics.test.js
  Analytics Command
    âˆš should handle analytics command successfully (4 ms)
    âˆš should handle analytics command error (1 ms)
    âˆš should handle analytics with fallback calculations (1 ms)
  Stats Command
    âˆš should handle stats command successfully
  Help Command
    âˆš should handle help command successfully
  Clear History Command
    âˆš should handle clearhistory command successfully (1 ms)
  Summary Command
    âˆš should handle summary command successfully (4 ms)
  Dashboard Command
    âˆš should handle dashboard command successfully (1 ms)
  Resources Command
    âˆš should handle resources command successfully (5 ms)

PASS __tests__/unit/message-formatter-basic.test.js
  Message Formatter - Basic
    formatResponse
      âˆš should format a response message with default options (3 ms)
      âˆš should remove excessive whitespace (1 ms)
      âˆš should truncate long messages (7 ms)
      âˆš should handle empty messages (1 ms)
      âˆš should handle null or undefined messages (1 ms)
      âˆš should handle messages with only whitespace
      âˆš should preserve single line breaks (1 ms)
      âˆš should handle messages with tabs

PASS __tests__/unit/config-env-validation.test.js
  Config - Environment Variable Validation
    Required Environment Variables
      âˆš should throw error when PERPLEXITY_API_KEY is missing (22 ms)
      âˆš should throw error when DISCORD_BOT_TOKEN is missing (5 ms)
      âˆš should throw error when both required env vars are missing (5 ms)
      âˆš should handle empty string environment variables (5 ms)
    getIntEnvVar Function Error Branches
      âˆš should return default value for invalid integer strings (5 ms)
      âˆš should handle valid integer environment variables (4 ms)
      âˆš should handle zero values correctly (3 ms)
      âˆš should handle negative integer values (4 ms)
      âˆš should handle large integer values (4 ms)
    Boolean Environment Variables
      âˆš should handle ENABLE_PI_OPTIMIZATIONS=true (5 ms)
      âˆš should handle ENABLE_PI_OPTIMIZATIONS=false (4 ms)
      âˆš should default to false when ENABLE_PI_OPTIMIZATIONS is undefined (5 ms)
      âˆš should handle malformed boolean environment variables (4 ms)

  console.log
    [2025-11-24T19:26:30.072Z] [INFO] Detected simple reminder request from user user123: "remind me in 5 minutes"

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:30.083Z] [INFO] Detected simple reminder request from user user123: "remind me in 5 minutes"

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:26:30.085Z] [ERROR] Error creating simple reminder:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at error (src/services/chat.js:211:12)
      at checkForSimpleReminderRequest (src/services/chat.js:155:12)
      at Object.<anonymous> (__tests__/unit/chat-service-basic.test.js:157:22)

  console.error
    Error: Test error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at error (src/services/chat.js:211:12)
      at checkForSimpleReminderRequest (src/services/chat.js:155:12)
      at Object.<anonymous> (__tests__/unit/chat-service-basic.test.js:157:22)

  console.error
    Stack: Error: Test error
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\chat-service-basic.test.js:155:51)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at error (src/services/chat.js:211:12)
      at checkForSimpleReminderRequest (src/services/chat.js:155:12)
      at Object.<anonymous> (__tests__/unit/chat-service-basic.test.js:157:22)

  console.log
    [2025-11-24T19:26:30.112Z] [INFO] Detected simple reminder request from user user123: "remind me to check email in 10 minutes"

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:30.113Z] [INFO] Detected simple reminder request from user user123: "please remind me about meeting in 1 hour"

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:30.114Z] [INFO] Detected simple reminder request from user user123: "can you remind me to call in 30 minutes"

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:30.114Z] [INFO] Detected simple reminder request from user user123: "set a reminder to take pills in 2 hours"

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:30.115Z] [INFO] Detected simple reminder request from user user123: "remind me in 15 minutes"

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:30.117Z] [INFO] Detected simple reminder request from user user123: "remind me in 15 minutes"

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:30.118Z] [INFO] Detected simple reminder request from user user123: "remind me in 5 minutes"

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:30.121Z] [INFO] Detected simple reminder request from user user123: "remind me in 10 minutes"

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:30.123Z] [INFO] Detected simple reminder request from user user123: "remind me to do something in 5 minutes"

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:26:30.124Z] [ERROR] Error creating simple reminder:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at error (src/services/chat.js:211:12)
      at checkForSimpleReminderRequest (src/services/chat.js:155:12)
      at Object.<anonymous> (__tests__/unit/chat-service-basic.test.js:247:22)

  console.error
    Error: Command failed

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at error (src/services/chat.js:211:12)
      at checkForSimpleReminderRequest (src/services/chat.js:155:12)
      at Object.<anonymous> (__tests__/unit/chat-service-basic.test.js:247:22)

  console.error
    Stack: Error: Command failed
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\chat-service-basic.test.js:245:51)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at error (src/services/chat.js:211:12)
      at checkForSimpleReminderRequest (src/services/chat.js:155:12)
      at Object.<anonymous> (__tests__/unit/chat-service-basic.test.js:247:22)

PASS __tests__/unit/chat-service-basic.test.js
  Chat Service - Basic
    âˆš should ignore bot messages (4 ms)
    âˆš should ignore empty messages (1 ms)
    âˆš should handle regular chat messages (91 ms)
    âˆš should ignore messages starting with "!" (text commands removed) (1 ms)
    âˆš should handle rate limited users (1 ms)
    Simple Reminder Detection
      âˆš should detect simple reminder patterns (11 ms)
      âˆš should return null for non-reminder messages (1 ms)
      âˆš should handle errors gracefully (29 ms)
      âˆš should handle different reminder pattern variations (4 ms)
      âˆš should handle DM server context (2 ms)
      âˆš should test reply function in simple reminder (2 ms)
      âˆš should call sendReminderResponse for successful reminders (2 ms)
      âˆš should handle reminder response formatting correctly (6 ms)
      âˆš should test uncovered error handling paths (47 ms)
      âˆš should handle edge case with empty reminder patterns (1 ms)

PASS __tests__/unit/utils/performance-tracker-basic.test.js
  PerformanceTracker - API Call Tracking
    trackApiCall
      âˆš should track successful API call (5 ms)
      âˆš should log slow operations
      âˆš should log very slow operations
      âˆš should track failed API call (1 ms)
      âˆš should include metadata in tracking
    analyzePerformanceTrends - Basic Cases
      âˆš should return default values for empty metrics (3 ms)
      âˆš should return default values for null metrics
      âˆš should analyze performance trends correctly (2 ms)

PASS __tests__/unit/commands-slash-handler.test.js
  Commands - Slash Command Handler
    handleSlashCommand
      âˆš should handle /help command (4 ms)
      âˆš should handle /clearhistory command (1 ms)
      âˆš should handle /summary command (3 ms)
      âˆš should handle /summary command API error (18 ms)
      âˆš should handle /summary command with only assistant messages in history (1 ms)
      âˆš should handle /summary command with no history (1 ms)
      âˆš should handle /stats command (1 ms)
      âˆš should handle /summarise command with text (1 ms)
      âˆš should handle /summarise command without text (1 ms)
      âˆš should handle /summarise command with empty text (1 ms)
      âˆš should handle /summarise command with invalid text (1 ms)
      âˆš should handle /summarise command API error (1 ms)
      âˆš should handle command execution error when not deferred (2 ms)
      âˆš should handle unknown command (1 ms)
      âˆš should handle command execution error (1 ms)
      âˆš should handle slash command with invalid user ID (1 ms)
      âˆš should handle slash command when already replied (3 ms)
      âˆš should handle slash command when already deferred and replied (1 ms)

PASS __tests__/unit/utils/performance-tracker.test.js
  PerformanceTracker - Advanced Analysis
    analyzePerformanceTrends - Memory Analysis
      âˆš should detect decreasing memory trend (3 ms)
      âˆš should detect stable memory trend (1 ms)
      âˆš should return insufficient_data for small datasets
    generatePerformanceReport
      âˆš should generate comprehensive performance report (1 ms)
      âˆš should generate recommendations for poor performance (1 ms)
      âˆš should generate positive recommendations for good performance
      âˆš should detect slow operations issue (1 ms)
      âˆš should detect memory leak warning (1 ms)
    _calculateBasicMetrics
      âˆš should calculate metrics correctly
      âˆš should count slow operations correctly
    _analyzeMemoryTrend
      âˆš should return insufficient_data for small datasets (1 ms)
    _generateRecommendations
      âˆš should recommend optimization for slow responses
      âˆš should recommend error investigation for low success rate (1 ms)
      âˆš should recommend memory leak investigation (1 ms)

PASS __tests__/unit/bot-shutdown.test.js
  Bot Shutdown
    âˆš should handle SIGINT and shut down gracefully (492 ms)
    âˆš should handle errors during shutdown and exit with code 1 (97 ms)

  console.error
    [2025-11-24T19:26:39.391Z] [ERROR] Error in extracting response content:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as _extractResponseContent] (src/services/perplexity-secure.js:446:42)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-content-extraction.test.js:50:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-content-extraction.test.js:50:69)

  console.error
    Error: Empty response received from the service.

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as _extractResponseContent] (src/services/perplexity-secure.js:446:42)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-content-extraction.test.js:50:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-content-extraction.test.js:50:69)

  console.error
    Stack: Error: Empty response received from the service.
        at PerplexityService._extractResponseContent (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:424:15)
        at _extractResponseContent (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-content-extraction.test.js:50:38)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\expect\build\toThrowMatchers.js:74:11)
        at Object.throwingMatcher [as toThrow] (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\expect\build\index.js:320:21)
        at Object.toThrow (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-content-extraction.test.js:50:69)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as _extractResponseContent] (src/services/perplexity-secure.js:446:42)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-content-extraction.test.js:50:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-content-extraction.test.js:50:69)

  console.warn
    [2025-11-24T19:26:39.405Z] [WARN] Response processing error: An unexpected error occurred. Please try again later.

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at PerplexityService.warn [as _extractResponseContent] (src/services/perplexity-secure.js:447:14)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-content-extraction.test.js:50:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-content-extraction.test.js:50:69)

  console.error
    [2025-11-24T19:26:39.409Z] [ERROR] Error in extracting response content:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as _extractResponseContent] (src/services/perplexity-secure.js:446:42)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-content-extraction.test.js:55:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-content-extraction.test.js:55:73)

  console.error
    Error: Empty response received from the service.

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as _extractResponseContent] (src/services/perplexity-secure.js:446:42)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-content-extraction.test.js:55:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-content-extraction.test.js:55:73)

  console.error
    Stack: Error: Empty response received from the service.
        at PerplexityService._extractResponseContent (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:429:15)
        at _extractResponseContent (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-content-extraction.test.js:55:38)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\expect\build\toThrowMatchers.js:74:11)
        at Object.throwingMatcher [as toThrow] (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\expect\build\index.js:320:21)
        at Object.toThrow (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-content-extraction.test.js:55:73)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as _extractResponseContent] (src/services/perplexity-secure.js:446:42)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-content-extraction.test.js:55:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-content-extraction.test.js:55:73)

  console.warn
    [2025-11-24T19:26:39.419Z] [WARN] Response processing error: An unexpected error occurred. Please try again later.

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at PerplexityService.warn [as _extractResponseContent] (src/services/perplexity-secure.js:447:14)
      at _extractResponseContent (__tests__/unit/services/perplexity-secure-content-extraction.test.js:55:38)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/perplexity-secure-content-extraction.test.js:55:73)

PASS __tests__/unit/services/perplexity-secure-content-extraction.test.js
  PerplexitySecure Service - Content Extraction
    _extractResponseContent method
      âˆš should extract content from message.content (2 ms)
      âˆš should extract content from choice.content
      âˆš should handle empty response (53 ms)
      âˆš should handle empty choices (14 ms)
      âˆš should return default message for invalid structure (1 ms)

PASS __tests__/unit/chat-validation-branches.test.js
  Chat Service - Message Validation Branch Coverage
    Bot Message Filtering
      âˆš should ignore messages from bots (151 ms)
      âˆš should process messages from real users (150 ms)
    Empty Message Filtering
      âˆš should ignore empty string messages (142 ms)
      âˆš should ignore whitespace-only messages (135 ms)
      âˆš should ignore null content (135 ms)
      âˆš should ignore undefined content (136 ms)
      âˆš should process valid non-empty messages (132 ms)
    Rate Limiting Branch Coverage
      âˆš should show rate limit message when user is rate limited (143 ms)
      âˆš should proceed normally when user is not rate limited (139 ms)

  console.log
    [2025-11-24T19:26:44.435Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:44.440Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:44.441Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:44.448Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:44.449Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:44.449Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:26:44.451Z] [ERROR] API 400 Error - Bad Request. Response: {"error":"Bad request"}

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as handleErrorResponse] (src/services/api-client.js:193:14)
      at ApiClient.handleResponse (src/services/api-client.js:144:7)
      at ApiClient.makeRequest (src/services/api-client.js:120:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-basic.test.js:55:7)

  console.error
    [2025-11-24T19:26:44.455Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-basic.test.js:55:7)

  console.error
    Error: API request failed with status 400: {"error":"Bad request"}

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-basic.test.js:55:7)

  console.error
    [2025-11-24T19:26:44.507Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-basic.test.js:55:7)

  console.error
    Error: API request failed with status 400: {"error":"Bad request"}

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-basic.test.js:55:7)

  console.error
    Stack: Error: API request failed with status 400: {"error":"Bad request"}
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleErrorResponse] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:201:32)
        at ApiClient.handleResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:144:7)
        at ApiClient.makeRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:120:14)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\perplexity-service-basic.test.js:55:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-basic.test.js:55:7)

  console.error
    [2025-11-24T19:26:44.517Z] [ERROR] API request failed: The service is temporarily unavailable. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at Object.<anonymous> (__tests__/unit/perplexity-service-basic.test.js:55:7)

  console.log
    [2025-11-24T19:26:44.520Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:44.520Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:44.521Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:26:44.522Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-basic.test.js:63:7)

  console.error
    Error: Network error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-basic.test.js:63:7)

  console.error
    [2025-11-24T19:26:44.526Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-basic.test.js:63:7)

  console.error
    Error: Request failed: Network error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-basic.test.js:63:7)

  console.error
    Stack: Error: Request failed: Network error
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\perplexity-service-basic.test.js:63:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-basic.test.js:63:7)

  console.error
    [2025-11-24T19:26:44.533Z] [ERROR] API request failed: An unexpected error occurred. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at Object.<anonymous> (__tests__/unit/perplexity-service-basic.test.js:63:7)

  console.error
    [2025-11-24T19:26:44.536Z] [ERROR] Empty messages array provided to buildRequestPayload

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as buildRequestPayload] (src/services/api-client.js:44:14)
      at PerplexityService.buildRequestPayload [as sendChatRequest] (src/services/perplexity-secure.js:460:43)
      at Object.sendChatRequest (__tests__/unit/perplexity-service-basic.test.js:70:38)

  console.log
    [2025-11-24T19:26:44.542Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:44.543Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:44.543Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:44.545Z] [INFO] API Request: model="sonar", messages=3, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:44.546Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:26:44.547Z] [INFO] Request payload summary: model=sonar, messages=3, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

PASS __tests__/unit/perplexity-service-basic.test.js
  Perplexity Service - Basic
    sendChatRequest
      âˆš sends a request to the API with correct parameters (13 ms)
      âˆš throws an error when API request fails (72 ms)
      âˆš handles network errors gracefully (16 ms)
      âˆš handles empty messages array (5 ms)
      âˆš handles single message (4 ms)
      âˆš handles multiple messages (6 ms)

PASS __tests__/unit/conversation-manager-basic.test.js
  Conversation Manager - Basic Operations
    getHistory
      âˆš returns empty array for new users (4 ms)
      âˆš returns conversation history for existing users (1 ms)
    addMessage
      âˆš adds message to new conversation (40 ms)
      âˆš adds message to existing conversation (7 ms)
      âˆš maintains conversation history limit (144 ms)
    clearHistory
      âˆš clears conversation history for user (7 ms)
      âˆš clears all conversation data when no userId provided (13 ms)

PASS __tests__/unit/services/database-users.test.js
  DatabaseService - User Management
    getUserStats
      âˆš should return default stats for non-existent user (133 ms)
      âˆš should return user stats when user exists (141 ms)
      âˆš should handle database errors gracefully (1 ms)
    updateUserStats
      âˆš should create user and update stats (145 ms)
      âˆš should update existing user stats (166 ms)
      âˆš should handle database errors gracefully (1 ms)
    getUserMessages
      âˆš should return empty array for non-existent user (136 ms)
      âˆš should return user messages in chronological order (209 ms)
      âˆš should limit results when limit is specified (235 ms)
      âˆš should handle database errors gracefully (2 ms)
    addUserMessage
      âˆš should add user message and create user if needed (155 ms)
      âˆš should handle database errors gracefully (1 ms)
    addBotResponse
      âˆš should add bot response and create user if needed (147 ms)
      âˆš should handle database errors gracefully (1 ms)

PASS __tests__/integration/bot-edge-cases-advanced.test.js
  Bot Edge Cases - Advanced
    âˆš should handle messages with mixed content types (2 ms)
    âˆš should handle messages with URLs (1 ms)
    âˆš should handle messages with email addresses (1 ms)
    âˆš should handle messages with mentions
    âˆš should handle messages with channel mentions (1 ms)
    âˆš should handle messages with role mentions
    âˆš should handle messages with custom emojis (1 ms)
    âˆš should handle messages with animated emojis
    âˆš should handle messages with timestamps
    âˆš should handle messages with spoilers (1 ms)
    âˆš should handle messages with strikethrough
    âˆš should handle messages with underlines (2 ms)
    âˆš should handle messages with quotes (1 ms)
    âˆš should handle messages with code blocks

PASS __tests__/integration/error.test.js
  Error handling
    âˆš handles failed Perplexity API response during chat (34 ms)
    âˆš handles failed summary API response (3 ms)

PASS __tests__/unit/services/perplexity-secure-api-response.test.js
  PerplexitySecure Service - API Response Handling
    _handleApiResponse method
      âˆš should throw error for null response (42 ms)
      âˆš should throw error for undefined response
      âˆš should handle error status codes
      âˆš should handle response without body (1 ms)
      âˆš should handle body without json method (1 ms)
      âˆš should handle JSON parsing errors
      âˆš should handle invalid response object
      âˆš should handle missing choices array (1 ms)
      âˆš should handle invalid choice structure (1 ms)
      âˆš should handle missing message field (1 ms)
      âˆš should return valid response data (1 ms)

PASS __tests__/unit/performance-monitor-core.test.js
  Performance Monitor - Core
    initialize
      âˆš should start monitoring in production environment (6 ms)
      âˆš should not start monitoring in test environment (1 ms)
      âˆš should not start monitoring if already initialized (1 ms)
    shutdown
      âˆš should clear interval and reset state (1 ms)
      âˆš should handle shutdown when not initialized (1 ms)

PASS __tests__/unit/performance-monitor-functions.test.js
  Performance Monitor - Functions
    throttle functions
      âˆš should throttle function calls based on interval (164 ms)
      âˆš should allow function calls after throttle interval (108 ms)
      âˆš should debounce function calls (157 ms)
    _getCpuInfo
      âˆš should return CPU information (2 ms)
    _checkPerformance
      âˆš should log performance metrics (22 ms)
      âˆš should handle errors gracefully (3 ms)

PASS __tests__/unit/services/database-user-stats.test.js
  DatabaseService - User Stats
    getUserStats
      âˆš should return default stats for non-existing user (142 ms)
      âˆš should return actual stats after user activity (142 ms)
    updateUserStats
      âˆš should update user stats correctly (138 ms)
      âˆš should handle empty updates gracefully (142 ms)
    ensureUserExists
      âˆš should create user if they do not exist (154 ms)
      âˆš should not modify existing user (146 ms)
      âˆš should handle database errors gracefully (1 ms)
    clearUserData
      âˆš should delete all user data (166 ms)
    clearUserConversationData
      âˆš should clear conversation data but preserve user stats (208 ms)
    exportUserData
      âˆš should export user data successfully (172 ms)
      âˆš should return null for database errors (1 ms)

  console.log
    [2025-11-24T19:27:06.020Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.028Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.029Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:06.032Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:29:7)

  console.error
    Error: API request failed with status 429: {"error":"Rate limit exceeded"}

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:29:7)

  console.warn
    [2025-11-24T19:27:06.083Z] [WARN] Rate limit error in API call to Perplexity API:

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at Function.warn [as handleError] (src/utils/error-handler.js:203:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:29:7)

  console.warn
    {
      type: 'RATE_LIMIT_ERROR',
      context: 'API call to Perplexity API',
      message: 'API request failed with status 429: {"error":"Rate limit exceeded"}',
      stack: 'Error: API request failed with status 429: {"error":"Rate limit exceeded"}\n' +
        '    at Function.createError (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\utils\\error-handler.js:287:19)\n' +
        '    at ApiClient.createError [as handleErrorResponse] (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\api-client.js:201:32)\n' +
        '    at ApiClient.handleResponse (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\api-client.js:144:7)\n' +
        '    at ApiClient.makeRequest (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\api-client.js:120:14)\n' +
        '    at makeApiRequest (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\perplexity-secure.js:464:14)\n' +
        '    at PerplexityService.sendChatRequest (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\perplexity-secure.js:475:20)\n' +
        '    at Object.<anonymous> (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\__tests__\\unit\\perplexity-service-advanced.test.js:29:7)',
      code: null,
      statusCode: 429,
      timestamp: '2025-11-24T19:27:06.083Z',
      endpoint: 'Perplexity API',
      statusMessage: 'Too Many Requests',
      responseData: undefined
    }

    [0m [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
     [90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
    [31m[1m>[22m[39m[90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m
     [90m 173 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.warn (src/utils/logger.js:170:25)
      at Function.warn [as handleError] (src/utils/error-handler.js:203:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:29:7)

  console.error
    [2025-11-24T19:27:06.090Z] [ERROR] API request failed: The service is currently busy. Please wait a moment and try again.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:29:7)

  console.log
    [2025-11-24T19:27:06.094Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.095Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.096Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:06.099Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:39:7)

  console.error
    Error: API request failed with status 500: {"error":"Internal server error"}

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:39:7)

  console.error
    [2025-11-24T19:27:06.103Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:39:7)

  console.error
    Error: API request failed with status 500: {"error":"Internal server error"}

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:39:7)

  console.error
    Stack: Error: API request failed with status 500: {"error":"Internal server error"}
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleErrorResponse] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:201:32)
        at ApiClient.handleResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:144:7)
        at ApiClient.makeRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:120:14)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\perplexity-service-advanced.test.js:39:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:39:7)

  console.error
    [2025-11-24T19:27:06.109Z] [ERROR] API request failed: Network connection issue. Please check your connection and try again.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:39:7)

  console.log
    [2025-11-24T19:27:06.112Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.113Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.114Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:06.114Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:49:7)

  console.error
    Error: API request failed with status 401: {"error":"Unauthorized"}

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:49:7)

  console.error
    [2025-11-24T19:27:06.119Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:49:7)

  console.error
    Error: API request failed with status 401: {"error":"Unauthorized"}

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:49:7)

  console.error
    Stack: Error: API request failed with status 401: {"error":"Unauthorized"}
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleErrorResponse] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:201:32)
        at ApiClient.handleResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:144:7)
        at ApiClient.makeRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:120:14)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\perplexity-service-advanced.test.js:49:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:49:7)

  console.error
    [2025-11-24T19:27:06.128Z] [ERROR] API request failed: The service is temporarily unavailable. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:49:7)

  console.log
    [2025-11-24T19:27:06.130Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.131Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.132Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:06.133Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:59:7)

  console.error
    Error: API request failed with status 403: {"error":"Forbidden"}

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:59:7)

  console.error
    [2025-11-24T19:27:06.136Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:59:7)

  console.error
    Error: API request failed with status 403: {"error":"Forbidden"}

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:59:7)

  console.error
    Stack: Error: API request failed with status 403: {"error":"Forbidden"}
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleErrorResponse] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:201:32)
        at ApiClient.handleResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:144:7)
        at ApiClient.makeRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:120:14)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\perplexity-service-advanced.test.js:59:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:59:7)

  console.error
    [2025-11-24T19:27:06.140Z] [ERROR] API request failed: The service is temporarily unavailable. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:59:7)

  console.log
    [2025-11-24T19:27:06.142Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.143Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.143Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:06.144Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:67:7)

  console.error
    Error: Request timeout

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:67:7)

  console.error
    [2025-11-24T19:27:06.148Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:67:7)

  console.error
    Error: Request failed: Request timeout

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:67:7)

  console.error
    Stack: Error: Request failed: Request timeout
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\perplexity-service-advanced.test.js:67:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:67:7)

  console.error
    [2025-11-24T19:27:06.153Z] [ERROR] API request failed: An unexpected error occurred. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:67:7)

  console.log
    [2025-11-24T19:27:06.158Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.159Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.160Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:06.161Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:77:7)

  console.error
    Error: Failed to parse API response: Invalid response: missing or empty choices array

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:77:7)

  console.error
    [2025-11-24T19:27:06.166Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:77:7)

  console.error
    Error: Request failed: Failed to parse API response: Invalid response: missing or empty choices array

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:77:7)

  console.error
    Stack: Error: Request failed: Failed to parse API response: Invalid response: missing or empty choices array
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\perplexity-service-advanced.test.js:77:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:77:7)

  console.error
    [2025-11-24T19:27:06.172Z] [ERROR] API request failed: The service is temporarily unavailable. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:77:7)

  console.log
    [2025-11-24T19:27:06.174Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.175Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.176Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:06.177Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:87:7)

  console.error
    Error: Failed to parse API response: Invalid response: missing or empty choices array

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:87:7)

  console.error
    [2025-11-24T19:27:06.179Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:87:7)

  console.error
    Error: Request failed: Failed to parse API response: Invalid response: missing or empty choices array

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:87:7)

  console.error
    Stack: Error: Request failed: Failed to parse API response: Invalid response: missing or empty choices array
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\perplexity-service-advanced.test.js:87:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:87:7)

  console.error
    [2025-11-24T19:27:06.184Z] [ERROR] API request failed: The service is temporarily unavailable. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:87:7)

  console.log
    [2025-11-24T19:27:06.189Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.191Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.192Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:06.193Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:97:7)

  console.error
    Error: Failed to parse API response: Invalid response: missing or empty choices array

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:97:7)

  console.error
    [2025-11-24T19:27:06.197Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:97:7)

  console.error
    Error: Request failed: Failed to parse API response: Invalid response: missing or empty choices array

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:97:7)

  console.error
    Stack: Error: Request failed: Failed to parse API response: Invalid response: missing or empty choices array
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\perplexity-service-advanced.test.js:97:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:97:7)

  console.error
    [2025-11-24T19:27:06.202Z] [ERROR] API request failed: The service is temporarily unavailable. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:97:7)

  console.log
    [2025-11-24T19:27:06.205Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.206Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.207Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:06.207Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:107:7)

  console.error
    Error: Failed to parse API response: Invalid response: missing content in choices

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:107:7)

  console.error
    [2025-11-24T19:27:06.212Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:107:7)

  console.error
    Error: Request failed: Failed to parse API response: Invalid response: missing content in choices

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:107:7)

  console.error
    Stack: Error: Request failed: Failed to parse API response: Invalid response: missing content in choices
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\perplexity-service-advanced.test.js:107:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:107:7)

  console.error
    [2025-11-24T19:27:06.217Z] [ERROR] API request failed: The service is temporarily unavailable. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at Object.<anonymous> (__tests__/unit/perplexity-service-advanced.test.js:107:7)

  console.log
    [2025-11-24T19:27:06.221Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.221Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.222Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.225Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.227Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.228Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.230Z] [INFO] API Request: model="sonar", messages=1, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.231Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:06.231Z] [INFO] Request payload summary: model=sonar, messages=1, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

PASS __tests__/unit/perplexity-service-advanced.test.js
  Perplexity Service - Advanced
    sendChatRequest advanced scenarios
      âˆš handles rate limiting errors (75 ms)
      âˆš handles server errors (17 ms)
      âˆš handles unauthorized errors (17 ms)
      âˆš handles forbidden errors (12 ms)
      âˆš handles timeout errors (15 ms)
      âˆš handles malformed response (16 ms)
      âˆš handles empty response (14 ms)
      âˆš handles response with no choices (15 ms)
      âˆš handles response with invalid choice structure (16 ms)
      âˆš handles very long messages (4 ms)
      âˆš handles messages with special characters (5 ms)
      âˆš handles messages with unicode characters (4 ms)

PASS __tests__/unit/logger-basic.test.js
  Logger - Basic
    âˆš logs debug messages (3 ms)
    âˆš logs debug messages with data (2 ms)
    âˆš logs info messages (1 ms)
    âˆš logs warning messages (1 ms)
    âˆš logs error messages (1 ms)
    âˆš logs error messages with data (1 ms)
    âˆš handles empty messages (1 ms)
    âˆš handles null messages (1 ms)
    âˆš handles undefined messages (1 ms)
    âˆš handles messages with special characters
    âˆš handles messages with unicode characters

PASS __tests__/__mocks__/discord.mock.test.js
  Discord.js mock
    âˆš Client mock exists (3 ms)
    âˆš Client mock has required methods (1 ms)
    âˆš SlashCommandBuilder mock exists (1 ms)

  console.log
    All messages in DB: [
      'Message 0',  'Message 1',
      'Message 2',  'Message 3',
      'Message 4',  'Message 5',
      'Message 6',  'Message 7',
      'Message 8',  'Message 9',
      'Message 10', 'Message 11',
      'Message 12', 'Message 13',
      'Message 14', 'Message 15',
      'Message 16', 'Message 17',
      'Message 18', 'Message 19'
    ]

      at Object.log (__tests__/unit/services/database-conversation.test.js:93:15)

PASS __tests__/unit/services/database-conversation.test.js
  DatabaseService - Conversation History
    getConversationHistory
      âˆš should return empty array for user with no conversation (145 ms)
      âˆš should return conversation history with proper roles (191 ms)
      âˆš should respect conversation limit (644 ms)
      âˆš should handle alternating user and bot messages correctly (238 ms)
      âˆš should handle database errors gracefully (127 ms)
      âˆš should return conversation history in chronological order (198 ms)

PASS __tests__/unit/message-chunker-basic.test.js
  Message Chunker - Basic
    âˆš should not chunk message that fits within max length (3 ms)
    âˆš should chunk a message that exceeds max length (1 ms)
    âˆš should preserve paragraph breaks when possible (1 ms)
    âˆš should add correct chunk numbering (1 ms)
    âˆš should handle empty message
    âˆš should handle null or undefined input (1 ms)
    âˆš should handle very small chunk size (2 ms)

PASS __tests__/__mocks__/loggerMock.test.js
  Logger Mock
    âˆš logger mock exists (2 ms)
    âˆš logger mock has required methods
    âˆš handleError returns a value
    âˆš _formatMessage returns a formatted message (1 ms)

PASS __tests__/unit/conversation-memory-performance.test.js
  ConversationManager - Memory and Performance
    Memory and Performance Edge Cases
      âˆš should handle many concurrent users efficiently (10 ms)
      âˆš should handle rapid successive messages from same user
      âˆš should handle alternating user and assistant messages
    Cleanup Operations
      âˆš should cleanup old conversations (3 ms)
      âˆš should preserve user stats during cleanup

PASS __tests__/unit/commands/cache.test.js
  Cache Command
    âˆš should handle cache command successfully with proper field values (6 ms)
    âˆš should never display "undefined" values in cache statistics (2 ms)
    âˆš should handle missing cache stats with proper fallback values (1 ms)
    âˆš should handle cache service throwing error gracefully (3 ms)
    âˆš should handle invalid user ID gracefully (5 ms)
    âˆš should display all required cache fields for v1.6.5 compatibility (2 ms)

PASS __tests__/unit/error-handler-retry-logic.test.js
  ErrorHandler - Retry Logic and Edge Cases
    Retry Logic
      âˆš should retry retryable errors (50 ms)
      âˆš should not retry non-retryable errors (12 ms)
      âˆš should exhaust retries for persistent errors (59 ms)
    Special Edge Cases
      âˆš should handle very large error objects (1 ms)
      âˆš should handle circular reference errors (1 ms)
    File and Validation Error Handling
      âˆš should handle file operation errors (1 ms)
      âˆš should handle validation errors with field info (1 ms)
      âˆš should truncate long values (1 ms)

PASS __tests__/unit/services/database-commands.test.js
  DatabaseService - Commands
    getCommandUsageStats
      âˆš should return default stats when no commands have been used (138 ms)
      âˆš should track command usage correctly (179 ms)
      âˆš should handle multiple command usages by same user (170 ms)
      âˆš should handle database errors gracefully (130 ms)
    trackCommandUsage
      âˆš should record command usage without throwing (150 ms)
      âˆš should handle database errors gracefully (158 ms)
      âˆš should handle empty command names (149 ms)
      âˆš should handle empty user IDs (160 ms)

PASS __tests__/unit/logger-level-filtering.test.js
  Logger - Log Level Filtering
    âˆš should skip debug logs when log level is INFO (5 ms)
    âˆš should skip info logs when log level is WARN (2 ms)
    âˆš should skip warn logs when log level is ERROR (3 ms)
    âˆš should process all log levels when set to DEBUG (3 ms)
    âˆš should handle invalid log level gracefully (3 ms)

PASS __tests__/unit/commands-slash-data.test.js
  Commands - Slash Commands Data
    getSlashCommandsData
      âˆš should return an array of slash command data (6 ms)

PASS __tests__/unit/enhanced-cache-stats.test.js
  EnhancedCache - Statistics
    Statistics and Metrics
      âˆš should track hit and miss statistics (4 ms)
      âˆš should track memory usage (1 ms)
      âˆš should track eviction count
      âˆš should provide detailed cache information (2 ms)
    Error Handling
      âˆš should handle invalid keys gracefully (1 ms)
      âˆš should handle invalid values gracefully (1 ms)
      âˆš should handle cache operations during shutdown (1 ms)
    Cache Entry
      âˆš should create cache entries with correct properties (1 ms)
      âˆš should track access count correctly
      âˆš should update last accessed time on get (22 ms)
    Configuration
      âˆš should accept custom configuration (1 ms)
      âˆš should use default configuration when none provided
      âˆš should handle invalid configuration gracefully (1 ms)

PASS __tests__/unit/memory-monitor-utils.test.js
  Memory Monitor - Utils
    âˆš should return memory usage information (4 ms)
    âˆš should calculate memory usage percentage correctly (1 ms)
    âˆš should handle memory usage errors (3 ms)
    âˆš should return status information (1 ms)
    âˆš should handle configuration-based initialization (1 ms)
    âˆš should handle memory threshold detection (55 ms)

PASS __tests__/integration/command-advanced.test.js
  Command Handling - Advanced
    âˆš !summarise command with text parameter (4 ms)
    âˆš !summerise command with text parameter (alternative spelling) (1 ms)
    âˆš handles empty summarise command (1 ms)
    âˆš handles summarise command with only whitespace
    âˆš handles very long text in summarise command (1 ms)
    âˆš handles special characters in summarise command (1 ms)
    âˆš handles multiline text in summarise command
    âˆš handles command with extra parameters
    âˆš handles case insensitive commands (1 ms)
    âˆš handles command with markdown formatting (1 ms)
    âˆš handles command with URLs
    âˆš handles command with emojis (1 ms)

  console.log
    [2025-11-24T19:27:38.865Z] [INFO] Final user stats saved before shutdown

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:38.878Z] [INFO] Final user stats saved before shutdown

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:38.879Z] [INFO] Auto-clearing conversation for user 123456789012345678 after 20 minutes of inactivity

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:38.882Z] [INFO] Auto-clearing conversation for user 123456789012345678 after 20 minutes of inactivity

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:38.899Z] [ERROR] Error in File saving user stats during shutdown:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleFileError] (src/utils/error-handler.js:258:17)
      at ConversationManager.handleFileError [as destroy] (src/utils/conversation.js:336:42)
      at Object.<anonymous> (__tests__/unit/conversation-manager-advanced.test.js:119:7)

  console.error
    Error: Save failed

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleFileError] (src/utils/error-handler.js:258:17)
      at ConversationManager.handleFileError [as destroy] (src/utils/conversation.js:336:42)
      at Object.<anonymous> (__tests__/unit/conversation-manager-advanced.test.js:119:7)

  console.error
    Stack: Error: Save failed
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\conversation-manager-advanced.test.js:116:42)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleFileError] (src/utils/error-handler.js:258:17)
      at ConversationManager.handleFileError [as destroy] (src/utils/conversation.js:336:42)
      at Object.<anonymous> (__tests__/unit/conversation-manager-advanced.test.js:119:7)

  console.error
    [2025-11-24T19:27:38.909Z] [ERROR] Failed to save user stats during shutdown: An unexpected error occurred. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ConversationManager.error [as destroy] (src/utils/conversation.js:341:14)
      at Object.<anonymous> (__tests__/unit/conversation-manager-advanced.test.js:119:7)

PASS __tests__/unit/conversation-manager-advanced.test.js
  Conversation Manager - Advanced Features
    destroy
      âˆš clears all intervals (11 ms)
      âˆš clears all conversation data (3 ms)
      âˆš should clear inactive conversations after timeout (5 ms)
      âˆš handles saveUserStats errors during destroy (28 ms)

PASS __tests__/unit/utils/discord-analytics.test.js
  DiscordAnalytics - trackServerActivity
    âˆš should track server activity correctly (4 ms)
    âˆš should handle missing serverId (1 ms)
    âˆš should handle missing action (1 ms)
    âˆš should include metadata when provided (1 ms)
  DiscordAnalytics - analyzeUsagePatterns
    âˆš should analyze usage patterns correctly (2 ms)
    âˆš should identify command popularity correctly (3 ms)
    âˆš should handle empty activity history
  DiscordAnalytics - generateDailyReport
    âˆš should generate comprehensive daily report (2 ms)
    âˆš should calculate summary statistics correctly (1 ms)
    âˆš should handle empty activity history gracefully (1 ms)
    âˆš should include successRate and avgResponseTime fields for analytics compatibility (1 ms)

PASS __tests__/unit/utils/security-monitor.test.js
  SecurityMonitor - Input Validation
    validateInput
      âˆš should return valid for safe input (4 ms)
      âˆš should detect XSS attempts (1 ms)
      âˆš should detect SQL injection attempts (1 ms)
      âˆš should detect command injection attempts
      âˆš should detect multiple security issues (1 ms)
      âˆš should handle empty input
      âˆš should handle null input (1 ms)
      âˆš should handle undefined input
    _detectXSSPatterns
      âˆš should detect script tags
      âˆš should detect javascript protocol (1 ms)
      âˆš should detect onload attribute
      âˆš should not detect safe content (1 ms)
    _detectSQLInjection
      âˆš should detect DROP TABLE
      âˆš should detect UNION SELECT
      âˆš should detect SQL comments
      âˆš should not detect safe SQL-like content
    _detectCommandInjection
      âˆš should detect dangerous commands (1 ms)
      âˆš should detect command chaining
      âˆš should not detect safe content (1 ms)
    error handling
      âˆš should handle errors in validateInput gracefully (19 ms)
      âˆš should handle errors in analyzeSecurityThreats gracefully (1 ms)

PASS __tests__/unit/lazy-loader.test.js
  Lazy Loader
    basic functionality
      âˆš should return a function that loads a module when called (2 ms)
      âˆš should handle modules with methods (1 ms)
    memoization
      âˆš should memoize the loaded module (1 ms)
    error handling
      âˆš should handle errors in the loader function (9 ms)

(node:19396) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGINT listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:19396) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGTERM listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
PASS __tests__/unit/index-uncovered-paths.test.js
  Index Uncovered Paths
    registerSlashCommands
      âˆš should handle client not ready (9 ms)
      âˆš should handle registration error (6 ms)
    Shutdown Handling
      âˆš should handle shutdown errors gracefully (30 ms)
      âˆš should ignore duplicate shutdown signals (7 ms)
    Error Handlers
      âˆš should handle unhandled rejections (6 ms)
      âˆš should handle uncaught exceptions (6 ms)

PASS __tests__/unit/cache-pruner.test.js
  Cache Pruner
    _initializePruningSchedule
      âˆš should set up interval based on config (3 ms)
      âˆš should execute pruneCache on interval (1 ms)
    pruneCache
      âˆš should call both pruning methods (3 ms)
      âˆš should handle errors (12 ms)
    _pruneQuestionCache
      âˆš should prune when over max entries (2 ms)
      âˆš should not prune when under max entries (1 ms)
      âˆš should handle missing file gracefully (1 ms)
    getStatus
      âˆš should return correct status information (2 ms)

  console.log
    [2025-11-24T19:27:50.081Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.088Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.089Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:50.091Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:52:7)

  console.error
    Error: API request failed with status 429: {"error":"Rate limit exceeded"}

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:52:7)

  console.warn
    [2025-11-24T19:27:50.149Z] [WARN] Rate limit error in API call to Perplexity API:

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at Function.warn [as handleError] (src/utils/error-handler.js:203:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:52:7)

  console.warn
    {
      type: 'RATE_LIMIT_ERROR',
      context: 'API call to Perplexity API',
      message: 'API request failed with status 429: {"error":"Rate limit exceeded"}',
      stack: 'Error: API request failed with status 429: {"error":"Rate limit exceeded"}\n' +
        '    at Function.createError (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\utils\\error-handler.js:287:19)\n' +
        '    at ApiClient.createError [as handleErrorResponse] (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\api-client.js:201:32)\n' +
        '    at ApiClient.handleResponse (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\api-client.js:144:7)\n' +
        '    at ApiClient.makeRequest (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\api-client.js:120:14)\n' +
        '    at makeApiRequest (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\perplexity-secure.js:464:14)\n' +
        '    at PerplexityService.sendChatRequest (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\perplexity-secure.js:475:20)\n' +
        '    at ResponseProcessor.generateResponseWithRetry (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\response-processor.js:135:14)\n' +
        '    at PerplexityService._processChatResponse (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\perplexity-secure.js:673:22)\n' +
        '    at PerplexityService.generateChatResponse (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\perplexity-secure.js:734:23)\n' +
        '    at Object.<anonymous> (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\__tests__\\unit\\services\\perplexity-secure-core.test.js:52:7)',
      code: null,
      statusCode: 429,
      timestamp: '2025-11-24T19:27:50.149Z',
      endpoint: 'Perplexity API',
      statusMessage: 'Too Many Requests',
      responseData: undefined
    }

    [0m [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
     [90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
    [31m[1m>[22m[39m[90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m
     [90m 173 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.warn (src/utils/logger.js:170:25)
      at Function.warn [as handleError] (src/utils/error-handler.js:203:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:52:7)

  console.error
    [2025-11-24T19:27:50.159Z] [ERROR] API request failed: The service is currently busy. Please wait a moment and try again.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:52:7)

  console.warn
    [2025-11-24T19:27:50.176Z] [WARN] Rate limit error in generate chat response:

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at Function.warn [as handleError] (src/utils/error-handler.js:203:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:52:7)

  console.warn
    {
      type: 'RATE_LIMIT_ERROR',
      context: 'generate chat response',
      message: 'API request failed with status 429: {"error":"Rate limit exceeded"}',
      stack: 'Error: API request failed with status 429: {"error":"Rate limit exceeded"}\n' +
        '    at Function.createError (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\utils\\error-handler.js:287:19)\n' +
        '    at ApiClient.createError [as handleErrorResponse] (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\api-client.js:201:32)\n' +
        '    at ApiClient.handleResponse (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\api-client.js:144:7)\n' +
        '    at ApiClient.makeRequest (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\api-client.js:120:14)\n' +
        '    at makeApiRequest (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\perplexity-secure.js:464:14)\n' +
        '    at PerplexityService.sendChatRequest (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\perplexity-secure.js:475:20)\n' +
        '    at ResponseProcessor.generateResponseWithRetry (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\response-processor.js:135:14)\n' +
        '    at PerplexityService._processChatResponse (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\perplexity-secure.js:673:22)\n' +
        '    at PerplexityService.generateChatResponse (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\src\\services\\perplexity-secure.js:734:23)\n' +
        '    at Object.<anonymous> (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\__tests__\\unit\\services\\perplexity-secure-core.test.js:52:7)',
      code: null,
      statusCode: 429,
      timestamp: '2025-11-24T19:27:50.176Z',
      historyLength: 1,
      shouldUseCache: true
    }

    [0m [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
     [90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
    [31m[1m>[22m[39m[90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m
     [90m 173 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.warn (src/utils/logger.js:170:25)
      at Function.warn [as handleError] (src/utils/error-handler.js:203:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:52:7)

  console.error
    [2025-11-24T19:27:50.179Z] [ERROR] Failed to generate chat response: The service is currently busy. Please wait a moment and try again.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as generateChatResponse] (src/services/perplexity-secure.js:765:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:52:7)

  console.log
    [2025-11-24T19:27:50.183Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.184Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.185Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:50.187Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:62:7)

  console.error
    Error: API request failed with status 500: {"error":"API Error"}

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:62:7)

  console.error
    [2025-11-24T19:27:50.196Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:62:7)

  console.error
    Error: API request failed with status 500: {"error":"API Error"}

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:62:7)

  console.error
    Stack: Error: API request failed with status 500: {"error":"API Error"}
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleErrorResponse] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:201:32)
        at ApiClient.handleResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:144:7)
        at ApiClient.makeRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:120:14)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at ResponseProcessor.generateResponseWithRetry (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\response-processor.js:135:14)
        at PerplexityService._processChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:673:22)
        at PerplexityService.generateChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:734:23)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-core.test.js:62:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:62:7)

  console.error
    [2025-11-24T19:27:50.204Z] [ERROR] API request failed: Network connection issue. Please check your connection and try again.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:62:7)

  console.error
    [2025-11-24T19:27:50.221Z] [ERROR] Error in generate chat response:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:62:7)

  console.error
    Error: API request failed with status 500: {"error":"API Error"}

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:62:7)

  console.error
    Stack: Error: API request failed with status 500: {"error":"API Error"}
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleErrorResponse] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:201:32)
        at ApiClient.handleResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:144:7)
        at ApiClient.makeRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:120:14)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at ResponseProcessor.generateResponseWithRetry (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\response-processor.js:135:14)
        at PerplexityService._processChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:673:22)
        at PerplexityService.generateChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:734:23)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-core.test.js:62:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:62:7)

  console.error
    [2025-11-24T19:27:50.227Z] [ERROR] Failed to generate chat response: Network connection issue. Please check your connection and try again.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as generateChatResponse] (src/services/perplexity-secure.js:765:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:62:7)

  console.log
    [2025-11-24T19:27:50.230Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.230Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.231Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:50.232Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:72:7)

  console.error
    Error: Network error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:72:7)

  console.error
    [2025-11-24T19:27:50.235Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:72:7)

  console.error
    Error: Request failed: Network error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:72:7)

  console.error
    Stack: Error: Request failed: Network error
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at ResponseProcessor.generateResponseWithRetry (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\response-processor.js:135:14)
        at PerplexityService._processChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:673:22)
        at PerplexityService.generateChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:734:23)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-core.test.js:72:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:72:7)

  console.error
    [2025-11-24T19:27:50.245Z] [ERROR] API request failed: An unexpected error occurred. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:72:7)

  console.error
    [2025-11-24T19:27:50.263Z] [ERROR] Error in generate chat response:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:72:7)

  console.error
    Error: Request failed: Network error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:72:7)

  console.error
    Stack: Error: Request failed: Network error
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at ResponseProcessor.generateResponseWithRetry (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\response-processor.js:135:14)
        at PerplexityService._processChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:673:22)
        at PerplexityService.generateChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:734:23)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-core.test.js:72:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:72:7)

  console.error
    [2025-11-24T19:27:50.269Z] [ERROR] Failed to generate chat response: An unexpected error occurred. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as generateChatResponse] (src/services/perplexity-secure.js:765:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:72:7)

  console.log
    [2025-11-24T19:27:50.271Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.272Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.273Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:50.274Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:82:7)

  console.error
    Error: Failed to parse API response: Invalid response: missing or empty choices array

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:82:7)

  console.error
    [2025-11-24T19:27:50.279Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:82:7)

  console.error
    Error: Request failed: Failed to parse API response: Invalid response: missing or empty choices array

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:82:7)

  console.error
    Stack: Error: Request failed: Failed to parse API response: Invalid response: missing or empty choices array
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at ResponseProcessor.generateResponseWithRetry (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\response-processor.js:135:14)
        at PerplexityService._processChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:673:22)
        at PerplexityService.generateChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:734:23)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-core.test.js:82:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:82:7)

  console.error
    [2025-11-24T19:27:50.287Z] [ERROR] API request failed: The service is temporarily unavailable. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:82:7)

  console.error
    [2025-11-24T19:27:50.299Z] [ERROR] Error in generate chat response:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:82:7)

  console.error
    Error: Request failed: Failed to parse API response: Invalid response: missing or empty choices array

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:82:7)

  console.error
    Stack: Error: Request failed: Failed to parse API response: Invalid response: missing or empty choices array
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at ResponseProcessor.generateResponseWithRetry (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\response-processor.js:135:14)
        at PerplexityService._processChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:673:22)
        at PerplexityService.generateChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:734:23)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-core.test.js:82:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:82:7)

  console.error
    [2025-11-24T19:27:50.304Z] [ERROR] Failed to generate chat response: The service is temporarily unavailable. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as generateChatResponse] (src/services/perplexity-secure.js:765:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:82:7)

  console.log
    [2025-11-24T19:27:50.306Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.307Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.308Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:50.309Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:92:7)

  console.error
    Error: Failed to parse API response: Invalid response: missing or empty choices array

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:92:7)

  console.error
    [2025-11-24T19:27:50.315Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:92:7)

  console.error
    Error: Request failed: Failed to parse API response: Invalid response: missing or empty choices array

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:92:7)

  console.error
    Stack: Error: Request failed: Failed to parse API response: Invalid response: missing or empty choices array
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at ResponseProcessor.generateResponseWithRetry (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\response-processor.js:135:14)
        at PerplexityService._processChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:673:22)
        at PerplexityService.generateChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:734:23)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-core.test.js:92:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:92:7)

  console.error
    [2025-11-24T19:27:50.321Z] [ERROR] API request failed: The service is temporarily unavailable. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at ResponseProcessor.generateResponseWithRetry (src/services/response-processor.js:135:14)
      at PerplexityService._processChatResponse (src/services/perplexity-secure.js:673:22)
      at PerplexityService.generateChatResponse (src/services/perplexity-secure.js:734:23)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:92:7)

  console.error
    [2025-11-24T19:27:50.339Z] [ERROR] Error in generate chat response:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:92:7)

  console.error
    Error: Request failed: Failed to parse API response: Invalid response: missing or empty choices array

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:92:7)

  console.error
    Stack: Error: Request failed: Failed to parse API response: Invalid response: missing or empty choices array
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at ResponseProcessor.generateResponseWithRetry (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\response-processor.js:135:14)
        at PerplexityService._processChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:673:22)
        at PerplexityService.generateChatResponse (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:734:23)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-core.test.js:92:7)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateChatResponse] (src/services/perplexity-secure.js:761:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:92:7)

  console.error
    [2025-11-24T19:27:50.344Z] [ERROR] Failed to generate chat response: The service is temporarily unavailable. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as generateChatResponse] (src/services/perplexity-secure.js:765:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:92:7)

  console.log
    [2025-11-24T19:27:50.347Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.348Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.349Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.366Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.367Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.368Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.385Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=1024

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.386Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.387Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.403Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=256

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.404Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.405Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:50.407Z] [ERROR] Invalid message format detected:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as buildRequestPayload] (src/services/api-client.js:54:14)
      at PerplexityService.buildRequestPayload [as sendChatRequest] (src/services/perplexity-secure.js:460:43)
      at PerplexityService.sendChatRequest [as generateTextSummary] (src/services/perplexity-secure.js:980:33)
      at PerplexityService.generateTextSummary [as generateSummary] (src/services/perplexity-secure.js:948:25)
      at Object.generateSummary (__tests__/unit/services/perplexity-secure-core.test.js:175:46)

  console.error
    Error: [{"role":"user","content":""}]

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as buildRequestPayload] (src/services/api-client.js:54:14)
      at PerplexityService.buildRequestPayload [as sendChatRequest] (src/services/perplexity-secure.js:460:43)
      at PerplexityService.sendChatRequest [as generateTextSummary] (src/services/perplexity-secure.js:980:33)
      at PerplexityService.generateTextSummary [as generateSummary] (src/services/perplexity-secure.js:948:25)
      at Object.generateSummary (__tests__/unit/services/perplexity-secure-core.test.js:175:46)

  console.error
    [2025-11-24T19:27:50.414Z] [ERROR] Error in generate summary:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateSummary] (src/services/perplexity-secure.js:950:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:175:22)

  console.error
    Error: All messages must have role and content fields

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateSummary] (src/services/perplexity-secure.js:950:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:175:22)

  console.error
    Stack: Error: All messages must have role and content fields
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as buildRequestPayload] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:55:26)
        at PerplexityService.buildRequestPayload [as sendChatRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:460:43)
        at PerplexityService.sendChatRequest [as generateTextSummary] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:980:33)
        at PerplexityService.generateTextSummary [as generateSummary] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:948:25)
        at Object.generateSummary (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-core.test.js:175:46)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateSummary] (src/services/perplexity-secure.js:950:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:175:22)

  console.error
    [2025-11-24T19:27:50.422Z] [ERROR] Failed to generate summary: An unexpected error occurred. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as generateSummary] (src/services/perplexity-secure.js:954:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:175:22)

  console.log
    [2025-11-24T19:27:50.424Z] [INFO] API Request: model="sonar", messages=2, temperature=0.2, max_tokens=256

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.425Z] [INFO] Making API request to: /chat/completions

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:50.426Z] [INFO] Request payload summary: model=sonar, messages=2, temperature=0.2

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.error
    [2025-11-24T19:27:50.427Z] [ERROR] API request failed for endpoint /chat/completions:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at PerplexityService.generateTextSummary (src/services/perplexity-secure.js:980:22)
      at PerplexityService.generateSummary (src/services/perplexity-secure.js:948:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:183:22)

  console.error
    Error: Summary generation failed

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at ApiClient.error [as makeRequest] (src/services/api-client.js:123:14)
      at makeApiRequest (src/services/perplexity-secure.js:464:14)
      at PerplexityService.sendChatRequest (src/services/perplexity-secure.js:475:20)
      at PerplexityService.generateTextSummary (src/services/perplexity-secure.js:980:22)
      at PerplexityService.generateSummary (src/services/perplexity-secure.js:948:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:183:22)

  console.error
    [2025-11-24T19:27:50.432Z] [ERROR] Error in API call to Perplexity API:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at PerplexityService.generateTextSummary (src/services/perplexity-secure.js:980:22)
      at PerplexityService.generateSummary (src/services/perplexity-secure.js:948:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:183:22)

  console.error
    Error: Request failed: Summary generation failed

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at PerplexityService.generateTextSummary (src/services/perplexity-secure.js:980:22)
      at PerplexityService.generateSummary (src/services/perplexity-secure.js:948:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:183:22)

  console.error
    Stack: Error: Request failed: Summary generation failed
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at PerplexityService.generateTextSummary (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:980:22)
        at PerplexityService.generateSummary (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:948:14)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-core.test.js:183:22)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at Function.handleError [as handleApiError] (src/utils/error-handler.js:240:17)
      at PerplexityService.handleApiError [as sendChatRequest] (src/services/perplexity-secure.js:480:42)
      at PerplexityService.generateTextSummary (src/services/perplexity-secure.js:980:22)
      at PerplexityService.generateSummary (src/services/perplexity-secure.js:948:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:183:22)

  console.error
    [2025-11-24T19:27:50.438Z] [ERROR] API request failed: An unexpected error occurred. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as sendChatRequest] (src/services/perplexity-secure.js:481:14)
      at PerplexityService.generateTextSummary (src/services/perplexity-secure.js:980:22)
      at PerplexityService.generateSummary (src/services/perplexity-secure.js:948:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:183:22)

  console.error
    [2025-11-24T19:27:50.441Z] [ERROR] Error in generate summary:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateSummary] (src/services/perplexity-secure.js:950:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:183:22)

  console.error
    Error: Request failed: Summary generation failed

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateSummary] (src/services/perplexity-secure.js:950:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:183:22)

  console.error
    Stack: Error: Request failed: Summary generation failed
        at Function.createError (C:\Users\chris\aszune-ai\aszune-ai-bot\src\utils\error-handler.js:287:19)
        at ApiClient.createError [as handleRequestError] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:216:25)
        at ApiClient.handleRequestError [as makeRequest] (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\api-client.js:124:18)
        at makeApiRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:464:14)
        at PerplexityService.sendChatRequest (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:475:20)
        at PerplexityService.generateTextSummary (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:980:22)
        at PerplexityService.generateSummary (C:\Users\chris\aszune-ai\aszune-ai-bot\src\services\perplexity-secure.js:948:14)
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\services\perplexity-secure-core.test.js:183:22)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at PerplexityService.handleError [as generateSummary] (src/services/perplexity-secure.js:950:42)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:183:22)

  console.error
    [2025-11-24T19:27:50.447Z] [ERROR] Failed to generate summary: An unexpected error occurred. Please try again later.

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at PerplexityService.error [as generateSummary] (src/services/perplexity-secure.js:954:14)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-core.test.js:183:22)

PASS __tests__/unit/services/perplexity-secure-core.test.js
  PerplexitySecure Service - Core
    generateChatResponse
      âˆš should handle rate limiting with 429 status code (103 ms)
      âˆš should handle API errors gracefully (47 ms)
      âˆš should handle network errors (41 ms)
      âˆš should handle invalid response format (35 ms)
      âˆš should handle empty response (41 ms)
      âˆš should handle successful response (19 ms)
      âˆš should handle backward compatibility with boolean caching parameter (18 ms)
      âˆš should handle object options parameter (17 ms)
    generateSummary
      âˆš should generate summary for conversation history (4 ms)
      âˆš should handle empty conversation history (18 ms)
      âˆš should handle summary generation errors (25 ms)

PASS __tests__/unit/logger-advanced.test.js
  Logger - Advanced
    âˆš respects log level filtering (3 ms)
    âˆš handles log level ERROR only (1 ms)
    âˆš handles log level WARN and above (1 ms)
    âˆš handles log level INFO and above
    âˆš handles log level DEBUG (all messages)
    âˆš handles invalid log level gracefully (1 ms)
    âˆš handles complex data objects (2 ms)
    âˆš handles circular references in data (3 ms)
    âˆš handles very long messages (1 ms)
    âˆš handles messages with newlines
    âˆš handles messages with tabs
    âˆš handles messages with carriage returns (1 ms)
    âˆš handles multiple data arguments (1 ms)

PASS __tests__/unit/pi-detector-config.test.js
  Pi Detector - Config Generation
    generateOptimizedConfig
      âˆš should generate config for Pi 4 with 2GB (3 ms)
      âˆš should generate config for Pi 4 with 1GB (1 ms)
      âˆš should generate config for Pi 4 with 4GB (2 ms)
      âˆš should generate config for Pi 3 (1 ms)
      âˆš should generate config for Pi 5 with 4GB (1 ms)
      âˆš should generate config for Pi 5 with 8GB (1 ms)
      âˆš should generate config for unknown Pi model (1 ms)
      âˆš should generate config for non-Pi systems (1 ms)

PASS __tests__/unit/index.test.js
  Bot Main Entry Point (index.js)
    âˆš should create a Discord client and log in (263 ms)
    Graceful Shutdown
      âˆš should register handler for SIGINT signal (27 ms)
      âˆš should register handler for SIGTERM signal (23 ms)
      âˆš should register handler for uncaughtException (22 ms)
      âˆš should call shutdown when uncaught exception occurs (28 ms)
      âˆš should log an error and exit if shutdown fails (100 ms)
      âˆš should register handler for unhandled promise rejections (23 ms)
    Boot Optimizations
      âˆš should initialize license validation when enabled (26 ms)
      âˆš should skip license validation when disabled (24 ms)
      âˆš should handle Pi optimizations initialization (84 ms)
      âˆš should handle Pi optimizations initialization failure gracefully (90 ms)
    Reminder Service Initialization
      âˆš should initialize reminder service on ready event (27 ms)
    Pi Optimizations in Production
      â—‹ skipped should initialize Pi optimizations in production mode
      â—‹ skipped should handle Pi optimizations initialization failure in production

  console.warn
    [2025-11-24T19:27:59.103Z] [WARN] Database migration warning (non-critical): Cannot read properties of undefined (reading 'some')

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _runMigrations] (src/services/database.js:167:14)
      at DatabaseService._runMigrations [as initTables] (src/services/database.js:145:12)
      at DatabaseService.initTables [as _initializeDatabase] (src/services/database.js:47:10)
      at DatabaseService._initializeDatabase [as getDb] (src/services/database.js:121:14)
      at Object.getDb (__tests__/unit/services/database.test.js:68:28)

  console.warn
    [2025-11-24T19:27:59.117Z] [WARN] Database migration warning (non-critical): Cannot read properties of undefined (reading 'some')

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _runMigrations] (src/services/database.js:167:14)
      at DatabaseService._runMigrations [as initTables] (src/services/database.js:145:12)
      at DatabaseService.initTables [as _initializeDatabase] (src/services/database.js:47:10)
      at DatabaseService._initializeDatabase [as getDb] (src/services/database.js:121:14)
      at Object.getDb (__tests__/unit/services/database.test.js:77:17)

  console.warn
    [2025-11-24T19:27:59.171Z] [WARN] Database migration warning (non-critical): Cannot read properties of undefined (reading 'some')

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _runMigrations] (src/services/database.js:167:14)
      at DatabaseService._runMigrations [as initTables] (src/services/database.js:145:12)
      at DatabaseService.initTables [as _initializeDatabase] (src/services/database.js:47:10)
      at DatabaseService._initializeDatabase [as getDb] (src/services/database.js:121:14)
      at Object.getDb (__tests__/unit/services/database.test.js:97:17)

  console.warn
    [2025-11-24T19:27:59.177Z] [WARN] Database migration warning (non-critical): Cannot read properties of undefined (reading 'some')

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _runMigrations] (src/services/database.js:167:14)
      at DatabaseService._runMigrations [as initTables] (src/services/database.js:145:12)
      at DatabaseService.initTables [as _initializeDatabase] (src/services/database.js:47:10)
      at DatabaseService._initializeDatabase [as getDb] (src/services/database.js:121:14)
      at DatabaseService.getDb [as _executeSqlStrict] (src/services/database.js:71:29)
      at DatabaseService._executeSqlStrict [as getUserStats] (src/services/database.js:348:17)
      at Object.getUserStats (__tests__/unit/services/database.test.js:124:32)

  console.warn
    [2025-11-24T19:27:59.182Z] [WARN] Database migration warning (non-critical): Cannot read properties of undefined (reading 'some')

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _runMigrations] (src/services/database.js:167:14)
      at DatabaseService._runMigrations [as initTables] (src/services/database.js:145:12)
      at DatabaseService.initTables [as _initializeDatabase] (src/services/database.js:47:10)
      at DatabaseService._initializeDatabase [as getDb] (src/services/database.js:121:14)
      at DatabaseService.getDb [as _executeSqlStrict] (src/services/database.js:71:29)
      at DatabaseService._executeSqlStrict [as getUserStats] (src/services/database.js:348:17)
      at Object.getUserStats (__tests__/unit/services/database.test.js:133:32)

  console.warn
    [2025-11-24T19:27:59.187Z] [WARN] Database migration warning (non-critical): Cannot read properties of undefined (reading 'some')

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _runMigrations] (src/services/database.js:167:14)
      at DatabaseService._runMigrations [as initTables] (src/services/database.js:145:12)
      at DatabaseService.initTables [as _initializeDatabase] (src/services/database.js:47:10)
      at DatabaseService._initializeDatabase [as getDb] (src/services/database.js:121:14)
      at DatabaseService.getDb [as _executeSqlStrict] (src/services/database.js:71:29)
      at DatabaseService._executeSqlStrict [as getUserStats] (src/services/database.js:348:17)
      at getUserStats (__tests__/unit/services/database.test.js:152:30)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/database.test.js:152:51)

  console.warn
    [2025-11-24T19:27:59.192Z] [WARN] Database migration warning (non-critical): Cannot read properties of undefined (reading 'some')

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _runMigrations] (src/services/database.js:167:14)
      at DatabaseService._runMigrations [as initTables] (src/services/database.js:145:12)
      at DatabaseService.initTables [as _initializeDatabase] (src/services/database.js:47:10)
      at DatabaseService._initializeDatabase [as getDb] (src/services/database.js:121:14)
      at DatabaseService.getDb [as updateUserStats] (src/services/database.js:492:23)
      at Object.updateUserStats (__tests__/unit/services/database.test.js:162:17)

  console.warn
    [2025-11-24T19:27:59.196Z] [WARN] Database migration warning (non-critical): Cannot read properties of undefined (reading 'some')

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _runMigrations] (src/services/database.js:167:14)
      at DatabaseService._runMigrations [as initTables] (src/services/database.js:145:12)
      at DatabaseService.initTables [as _initializeDatabase] (src/services/database.js:47:10)
      at DatabaseService._initializeDatabase [as getDb] (src/services/database.js:121:14)
      at DatabaseService.getDb [as updateUserStats] (src/services/database.js:492:23)
      at Object.updateUserStats (__tests__/unit/services/database.test.js:182:17)

  console.warn
    [2025-11-24T19:27:59.201Z] [WARN] Database migration warning (non-critical): Cannot read properties of undefined (reading 'some')

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _runMigrations] (src/services/database.js:167:14)
      at DatabaseService._runMigrations [as initTables] (src/services/database.js:145:12)
      at DatabaseService.initTables [as _initializeDatabase] (src/services/database.js:47:10)
      at DatabaseService._initializeDatabase [as getDb] (src/services/database.js:121:14)
      at DatabaseService.getDb [as updateUserStats] (src/services/database.js:492:23)
      at updateUserStats (__tests__/unit/services/database.test.js:206:30)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/database.test.js:206:76)

  console.log
    [2025-11-24T19:27:59.209Z] [INFO] Running migration: Adding username column to user_stats table

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:59.210Z] [INFO] Migration completed: username column added to user_stats

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:59.212Z] [INFO] Running migration: Adding username column to user_stats table

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    [2025-11-24T19:27:59.213Z] [INFO] Migration completed: username column added to user_stats

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.warn
    [2025-11-24T19:27:59.215Z] [WARN] Database migration warning (non-critical): Query failed

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _runMigrations] (src/services/database.js:167:14)
      at DatabaseService._runMigrations [as initTables] (src/services/database.js:145:12)
      at DatabaseService.initTables [as _initializeDatabase] (src/services/database.js:47:10)
      at DatabaseService._initializeDatabase [as getDb] (src/services/database.js:121:14)
      at DatabaseService.getDb [as _executeSql] (src/services/database.js:57:29)
      at DatabaseService._executeSql [as getUserMessages] (src/services/database.js:536:17)
      at getUserMessages (__tests__/unit/services/database.test.js:237:30)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/database.test.js:237:58)

  console.warn
    [2025-11-24T19:27:59.218Z] [WARN] Database operation error: Query failed

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _executeSql] (src/services/database.js:59:14)
      at DatabaseService._executeSql [as getUserMessages] (src/services/database.js:536:17)
      at getUserMessages (__tests__/unit/services/database.test.js:237:30)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/database.test.js:237:58)

  console.warn
    [2025-11-24T19:27:59.222Z] [WARN] Database migration warning (non-critical): Cannot read properties of undefined (reading 'some')

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _runMigrations] (src/services/database.js:167:14)
      at DatabaseService._runMigrations [as initTables] (src/services/database.js:145:12)
      at DatabaseService.initTables [as _initializeDatabase] (src/services/database.js:47:10)
      at DatabaseService._initializeDatabase [as getDb] (src/services/database.js:121:14)
      at DatabaseService.getDb [as _executeSqlStrict] (src/services/database.js:71:29)
      at DatabaseService._executeSqlStrict [as addUserMessage] (src/services/database.js:546:17)
      at Object.addUserMessage (__tests__/unit/services/database.test.js:245:17)

  console.warn
    [2025-11-24T19:27:59.226Z] [WARN] Database migration warning (non-critical): Cannot read properties of undefined (reading 'some')

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _runMigrations] (src/services/database.js:167:14)
      at DatabaseService._runMigrations [as initTables] (src/services/database.js:145:12)
      at DatabaseService.initTables [as _initializeDatabase] (src/services/database.js:47:10)
      at DatabaseService._initializeDatabase [as getDb] (src/services/database.js:121:14)
      at DatabaseService.getDb [as _executeSqlStrict] (src/services/database.js:71:29)
      at DatabaseService._executeSqlStrict [as addUserMessage] (src/services/database.js:546:17)
      at addUserMessage (__tests__/unit/services/database.test.js:255:30)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/database.test.js:255:68)

  console.warn
    [2025-11-24T19:27:59.230Z] [WARN] All schema attempts failed for user 123

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as ensureUserExists] (src/services/database.js:629:16)
      at ensureUserExists (src/services/database.js:547:12)
      at DatabaseService.operation [as _executeSqlStrict] (src/services/database.js:71:14)
      at DatabaseService._executeSqlStrict [as addUserMessage] (src/services/database.js:546:17)
      at addUserMessage (__tests__/unit/services/database.test.js:255:30)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/database.test.js:255:68)

  console.warn
    [2025-11-24T19:27:59.233Z] [WARN] Database migration warning (non-critical): Cannot read properties of undefined (reading 'some')

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _runMigrations] (src/services/database.js:167:14)
      at DatabaseService._runMigrations [as initTables] (src/services/database.js:145:12)
      at DatabaseService.initTables [as _initializeDatabase] (src/services/database.js:47:10)
      at DatabaseService._initializeDatabase [as getDb] (src/services/database.js:121:14)
      at DatabaseService.getDb [as _executeSqlStrict] (src/services/database.js:71:29)
      at DatabaseService._executeSqlStrict [as clearUserData] (src/services/database.js:698:17)
      at Object.clearUserData (__tests__/unit/services/database.test.js:265:17)

  console.warn
    [2025-11-24T19:27:59.237Z] [WARN] Database migration warning (non-critical): Cannot read properties of undefined (reading 'some')

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _runMigrations] (src/services/database.js:167:14)
      at DatabaseService._runMigrations [as initTables] (src/services/database.js:145:12)
      at DatabaseService.initTables [as _initializeDatabase] (src/services/database.js:47:10)
      at DatabaseService._initializeDatabase [as getDb] (src/services/database.js:121:14)
      at DatabaseService.getDb [as _executeSqlStrict] (src/services/database.js:71:29)
      at DatabaseService._executeSqlStrict [as clearUserData] (src/services/database.js:698:17)
      at clearUserData (__tests__/unit/services/database.test.js:275:30)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/services/database.test.js:275:52)

  console.warn
    [2025-11-24T19:27:59.247Z] [WARN] Database migration warning (non-critical): Cannot read properties of undefined (reading 'some')

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at DatabaseService.warn [as _runMigrations] (src/services/database.js:167:14)
      at DatabaseService._runMigrations [as initTables] (src/services/database.js:145:12)
      at DatabaseService.initTables [as _initializeDatabase] (src/services/database.js:47:10)
      at DatabaseService._initializeDatabase [as getDb] (src/services/database.js:121:14)
      at Object.getDb (__tests__/unit/services/database.test.js:283:17)

PASS __tests__/unit/services/database.test.js
  DatabaseService
    constructor
      âˆš should initialize without accessing config (3 ms)
    getDb
      âˆš should initialize database on first call and access config (15 ms)
      âˆš should return existing db on subsequent calls (5 ms)
      âˆš should throw error on database initialization failure (47 ms)
    initTables
      âˆš should create user_stats and user_messages tables (5 ms)
      âˆš should throw error on table creation failure (1 ms)
    getUserStats
      âˆš should return user stats for existing user (5 ms)
      âˆš should return default stats for non-existing user (4 ms)
      âˆš should throw error on query failure (5 ms)
    updateUserStats
      âˆš should update user stats correctly (4 ms)
      âˆš should handle missing updates gracefully (4 ms)
      âˆš should throw error on update failure (8 ms)
    getUserMessages
      âˆš should return last 10 messages for user (3 ms)
      âˆš should return empty array for user with no messages (3 ms)
      âˆš should throw error on query failure (7 ms)
    addUserMessage
      âˆš should add message to database (5 ms)
      âˆš should throw error on insert failure (6 ms)
    clearUserData
      âˆš should delete all user data (4 ms)
      âˆš should throw error on delete failure (5 ms)
    close
      âˆš should close database connection (9 ms)
      âˆš should handle close when db is not initialized (1 ms)
      â—‹ skipped should throw error on close failure

PASS __tests__/unit/config.test.js
  Config
    basic configuration
      âˆš exports required configuration settings (6 ms)
      âˆš should have required environment variables available (3 ms)
    nested configuration
      âˆš should have API configuration (3 ms)
      âˆš should have system messages defined (3 ms)
      âˆš should have emoji reactions defined (4 ms)
    initializePiOptimizations
      âˆš should have initializePiOptimizations function available (3 ms)
      âˆš should return a promise when initializePiOptimizations is called (3 ms)

PASS __tests__/unit/source-reference-processor-branch-coverage.test.js
  Source Reference Processor - Branch Coverage
    processSourceReferences
      âˆš should handle empty text (2 ms)
      âˆš should handle null/undefined text (1 ms)
      âˆš should handle text without source references (1 ms)
      âˆš should handle different source reference formats (1 ms)
      âˆš should handle source references with different numbers (1 ms)
      âˆš should handle malformed source references
      âˆš should handle source references in different positions (1 ms)
      âˆš should handle source references with special characters (1 ms)
      âˆš should handle source references with markdown (1 ms)
      âˆš should handle edge cases (4 ms)
      âˆš should handle very long text (1 ms)
      âˆš should handle text with many source references
      âˆš should handle mixed valid and invalid source references (1 ms)

PASS __tests__/integration/bot-core.test.js
  Bot Integration - Core
    âˆš should have attached the messageCreate handler (164 ms)
    âˆš handles a normal message and replies (39 ms)
    âˆš replies to !help command (44 ms)
    âˆš replies to !clearhistory command (44 ms)
    âˆš replies to !summary with history (38 ms)
    âˆš replies to !summary with no history (43 ms)
    âˆš ignores unknown command (43 ms)
    âˆš ignores messages from bots (40 ms)

  console.log
    TEST: Starting addUserMessage test

      at Object.log (__tests__/unit/services/database-messages.test.js:127:15)

  console.log
    TEST: Database path: C:\Users\chris\aszune-ai\aszune-ai-bot\test-data\bot.db

      at Object.log (__tests__/unit/services/database-messages.test.js:128:15)

  console.log
    TEST: Database file exists before: false

      at Object.log (__tests__/unit/services/database-messages.test.js:129:15)

  console.log
    TEST: DB connection 1: Database {
      name: 'C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\test-data\\bot.db',
      open: true,
      inTransaction: false,
      readonly: false,
      memory: false
    }

      at Object.log (__tests__/unit/services/database-messages.test.js:132:15)

  console.log
    TEST: addUserMessage completed

      at Object.log (__tests__/unit/services/database-messages.test.js:135:15)

  console.log
    TEST: DB connection 2: Database {
      name: 'C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\test-data\\bot.db',
      open: true,
      inTransaction: false,
      readonly: false,
      memory: false
    }

      at Object.log (__tests__/unit/services/database-messages.test.js:138:15)

  console.log
    TEST: Same connection? true

      at Object.log (__tests__/unit/services/database-messages.test.js:139:15)

  console.log
    TEST: Database file exists after: true

      at Object.log (__tests__/unit/services/database-messages.test.js:141:15)

  console.log
    TEST: Database file size: 102400

      at Object.log (__tests__/unit/services/database-messages.test.js:145:17)

  console.log
    TEST: Retrieved messages: [ 'Hello world' ]

      at Object.log (__tests__/unit/services/database-messages.test.js:149:15)

  console.log
    TEST: Raw SQL result: [
      {
        id: 1,
        user_id: '123',
        message: 'Hello world',
        timestamp: '2025-11-24 19:28:09'
      }
    ]

      at Object.log (__tests__/unit/services/database-messages.test.js:154:15)

PASS __tests__/unit/services/database-messages.test.js
  DatabaseService - Messages
    getUserMessages
      âˆš should return empty array for user with no messages (127 ms)
      âˆš should return user messages after adding them (181 ms)
      âˆš should respect message limit (635 ms)
    addUserMessage
      âˆš should add message to database (170 ms)
    addBotResponse
      âˆš should add bot response with prefix (156 ms)

PASS __tests__/unit/message-chunker-table-formatting.test.js
  Message Chunker - Table Formatting
    formatTablesForDiscord
      âˆš should return unchanged content when no tables are present (2 ms)
      âˆš should format basic table into bullet points (1 ms)
      âˆš should handle tables with separator lines
      âˆš should handle mixed content with tables (1 ms)
      âˆš should handle malformed table rows gracefully
      âˆš should handle empty input (1 ms)
      âˆš should handle tables with special characters (1 ms)
      âˆš should handle single column tables (1 ms)
      âˆš should preserve non-table pipe characters

PASS __tests__/unit/memory-monitor-checking.test.js
  Memory Monitor - Checking
    âˆš should trigger garbage collection when memory exceeds limit (53 ms)
    âˆš should clear low memory flag when memory usage drops (1 ms)
    âˆš should handle critical memory threshold (1 ms)
    âˆš should handle memory check errors gracefully (2 ms)
    âˆš should force garbage collection when not recently called (82 ms)
    âˆš should not force garbage collection if recently called (1 ms)
    âˆš should handle garbage collection when gc is not available (130 ms)
    âˆš should handle garbage collection errors (5 ms)

PASS __tests__/unit/connection-throttler.test.js
  Connection Throttler
    executeRequest
      âˆš should execute requests immediately when under max connections (3 ms)
      âˆš should queue requests when at max connections (1 ms)
      âˆš should handle errors in requests (10 ms)
      âˆš should process next queue item after completion (1 ms)
    clearQueue
      âˆš should clear all queued requests (1 ms)

PASS __tests__/unit/chunk-boundary-handler-branch-coverage.test.js
  Chunk Boundary Handler - Branch Coverage
    validateChunkBoundaries
      âˆš should handle empty chunks array (3 ms)
      âˆš should handle single chunk
      âˆš should handle chunks with different content types (2 ms)
      âˆš should handle chunks with incomplete markdown (1 ms)
      âˆš should handle chunks with special characters (1 ms)
      âˆš should handle chunks with different lengths (1 ms)
      âˆš should handle edge cases (1 ms)
      âˆš should handle chunks with complex markdown (1 ms)
      âˆš should handle chunks with mixed content

PASS __tests__/integration/messageFlow.test.js
  Message flow
    âˆš adds user and assistant messages to conversationHistory (3 ms)

PASS __tests__/unit/enhanced-message-chunker.test.js
  Enhanced Message Chunker
    âˆš processes source references correctly (3 ms)
    âˆš handles YouTube links in sources correctly (1 ms)
    âˆš preserves formatting for multiple source references (1 ms)
    âˆš chunking preserves source references across chunks (2 ms)
    âˆš handles URLs split between chunks (2 ms)

PASS __tests__/utils/undici-mock.js
  Undici Mock
    âˆš should exist (2 ms)

PASS __tests__/unit/commands-cache.test.js
  Commands - Cache Command
    /cache command
      âˆš should handle /cache command successfully (5 ms)
      âˆš should handle /cache command with detailed info having entries (1 ms)
      âˆš should handle /cache command API error (29 ms)
      âˆš should handle /cache command with invalid user ID (1 ms)

PASS __tests__/integration/command-basic.test.js
  Command Handling - Basic
    âˆš responds to !clearhistory and clears the conversation history (3 ms)
    âˆš !help command replies with help message
    âˆš !summary command replies with summary message (1 ms)
    âˆš !stats command replies with stats message (1 ms)
    âˆš handles unknown commands gracefully
    âˆš ignores messages that do not start with ! (1 ms)

PASS __tests__/__mocks__/discord.mock.js.test.js
  Discord mock
    âˆš Mock is valid (2 ms)

  console.log
    [2025-11-24T19:28:30.292Z] [INFO] Final cache statistics:

      at Logger.log [as info] (src/utils/logger.js:152:15)

  console.log
    { hits: 10, misses: 5 }

      at Logger.log [as info] (src/utils/logger.js:153:25)

  console.warn
    [2025-11-24T19:28:30.311Z] [WARN] Failed to log test_metric: DB error

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at PerplexityService.warn [as _trackMetric] (src/services/perplexity-secure.js:243:14)

  console.warn
    [2025-11-24T19:28:30.317Z] [WARN] Failed to log api_cache_hit_time: DB error

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at PerplexityService.warn [as _trackMetric] (src/services/perplexity-secure.js:243:14)
      at PerplexityService._trackCacheHitPerformance (src/services/perplexity-secure.js:537:5)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-coverage.test.js:204:9)

  console.warn
    [2025-11-24T19:28:30.320Z] [WARN] Failed to log memory_usage_delta: DB error

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at PerplexityService.warn [as _trackMetric] (src/services/perplexity-secure.js:243:14)
      at PerplexityService._trackCacheHitPerformance (src/services/perplexity-secure.js:538:5)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-coverage.test.js:204:9)

  console.warn
    [2025-11-24T19:28:30.323Z] [WARN] Failed to log api_response_time: DB error

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at PerplexityService.warn [as _trackMetric] (src/services/perplexity-secure.js:243:14)
      at PerplexityService._trackApiCallPerformance (src/services/perplexity-secure.js:551:5)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-coverage.test.js:228:9)

  console.warn
    [2025-11-24T19:28:30.326Z] [WARN] Failed to log memory_usage_delta: DB error

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at PerplexityService.warn [as _trackMetric] (src/services/perplexity-secure.js:243:14)
      at PerplexityService._trackApiCallPerformance (src/services/perplexity-secure.js:552:5)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-coverage.test.js:228:9)

  console.warn
    [2025-11-24T19:28:30.328Z] [WARN] Failed to log memory_usage_current: DB error

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at PerplexityService.warn [as _trackMetric] (src/services/perplexity-secure.js:243:14)
      at PerplexityService._trackApiCallPerformance (src/services/perplexity-secure.js:553:5)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-coverage.test.js:228:9)

  console.warn
    [2025-11-24T19:28:30.331Z] [WARN] Failed to log api_error_time: DB error

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at PerplexityService.warn [as _trackMetric] (src/services/perplexity-secure.js:243:14)
      at PerplexityService._trackApiErrorPerformance (src/services/perplexity-secure.js:564:5)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-coverage.test.js:261:9)

  console.warn
    [2025-11-24T19:28:30.333Z] [WARN] Failed to log memory_usage_delta: DB error

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at PerplexityService.warn [as _trackMetric] (src/services/perplexity-secure.js:243:14)
      at PerplexityService._trackApiErrorPerformance (src/services/perplexity-secure.js:565:5)
      at Object.<anonymous> (__tests__/unit/services/perplexity-secure-coverage.test.js:261:9)

PASS __tests__/unit/services/perplexity-secure-coverage.test.js
  PerplexitySecure Service - Additional Private Methods
    _setupCacheCleanup method
      âˆš should set up cache cleanup interval when not in test environment (7 ms)
      âˆš should not set up cache cleanup interval in test environment (1 ms)
    shutdown method
      âˆš should clear all active intervals and log final stats (17 ms)
    Performance tracking methods
      _trackApiPerformance method
        âˆš should log performance metric successfully (2 ms)
        âˆš should handle database errors gracefully (6 ms)
      _trackCacheHitPerformance method
        âˆš should track cache hit performance metrics (7 ms)
      _trackApiCallPerformance method
        âˆš should track API call performance metrics (7 ms)
      _trackApiErrorPerformance method
        âˆš should track API error performance metrics (6 ms)
    _cleanupCache method
      âˆš should use cache pruner when available (1 ms)
      âˆš should fall back to manual cache cleanup when pruner is not available (17 ms)
      âˆš should handle cache loading errors gracefully
      âˆš should handle empty cache gracefully

PASS __tests__/unit/config-pi-optimization.test.js
  Config - Pi Optimization Branch Coverage
    Pi Optimization Environment Variables
      âˆš should handle various debounce values (5 ms)
      âˆš should handle various memory limit values (4 ms)
      âˆš should handle max connections setting (4 ms)
      âˆš should use default values when Pi env vars are not set (4 ms)
    initializePiOptimizations Function Branches
      âˆš should return config when pi-detector succeeds (5 ms)
      âˆš should handle pi-detector errors gracefully (5 ms)
      âˆš should handle missing pi-detector module gracefully (4 ms)
      âˆš should handle pi-detector returning null (4 ms)
      âˆš should handle pi-detector returning undefined (4 ms)
    Configuration Structure Edge Cases
      âˆš should handle different PI_LOG_LEVEL values (7 ms)
      âˆš should handle boolean environment variables correctly (4 ms)
      âˆš should handle reaction limit values (4 ms)
      âˆš should handle stream responses setting (4 ms)
      âˆš should have all required configuration sections (4 ms)

PASS __tests__/unit/pi-detector-init.test.js
  Pi Detector - Initialization
    initPiOptimizations
      âˆš should initialize and return optimized config (4 ms)
      âˆš should respect environment variable overrides
      âˆš should handle errors and return safe defaults (1 ms)
      âˆš should not initialize Pi optimizations when disabled by environment variable (2 ms)
      âˆš should use environment-provided values when initialization fails (1 ms)

PASS __tests__/unit/memory-monitor-core.test.js
  Memory Monitor - Core
    âˆš should have correct default values (4 ms)
    âˆš should initialize successfully (2 ms)
    âˆš should not initialize if already initialized
    âˆš should setup memory check interval on initialization (1 ms)
    âˆš should shutdown successfully when initialized (3 ms)
    âˆš should handle shutdown when not initialized
    âˆš should clear interval on shutdown (1 ms)

PASS __tests__/unit/utils/performance-dashboard.test.js
  PerformanceDashboard - generateDashboardReport
    âˆš should generate comprehensive dashboard report (3 ms)
    âˆš should include correct overview information (1 ms)
    âˆš should include responseTime and averageResponseTime fields for compatibility (3 ms)
    âˆš should call all required service methods (3 ms)
    âˆš should handle empty input gracefully (1 ms)
  PerformanceDashboard - getRealTimeStatus
    âˆš should return real-time status information (1 ms)
    âˆš should include uptime in seconds and formatted (1 ms)
    âˆš should include memory usage information (1 ms)
    âˆš should have online status (1 ms)
  PerformanceDashboard - generateAlerts
    âˆš should generate memory alerts for high usage (1 ms)
    âˆš should generate performance alerts for slow response times (1 ms)
    âˆš should generate reliability alerts for high error rates
    âˆš should not generate alerts for good metrics (1 ms)
    âˆš should generate warning alerts for elevated metrics (1 ms)
    âˆš should include timestamp in alerts
  PerformanceDashboard - exportDashboardData
    âˆš should export as JSON by default
    âˆš should export as JSON when explicitly specified
    âˆš should export as CSV format
    âˆš should export as text format (1 ms)
    âˆš should fallback to JSON for unknown formats (1 ms)
  PerformanceDashboard - Private Methods
    âˆš should calculate overall status correctly for healthy system
    âˆš should calculate overall status correctly for critical system (1 ms)
    âˆš should format uptime correctly
    âˆš should generate insights from analytics patterns (1 ms)
  PerformanceDashboard - Error Handling
    âˆš should handle missing dependencies gracefully (1 ms)
    âˆš should handle null inputs gracefully (1 ms)
    âˆš should provide fallback values when services fail
  PerformanceDashboard - Performance
    âˆš should generate dashboard quickly (4 ms)
    âˆš should handle large alert datasets efficiently (3 ms)

PASS __tests__/unit/enhanced-cache-eviction.test.js
  EnhancedCache - Eviction
    Size Management
      âˆš should enforce max entries limit (3 ms)
      âˆš should enforce max size limit (1 ms)
      âˆš should calculate entry size correctly (1 ms)
    Eviction Strategies
      âˆš should use LRU eviction strategy (1 ms)
      âˆš should use LFU eviction strategy (1 ms)
      âˆš should use TTL eviction strategy

PASS __tests__/__mocks__/discord.test.js
  Discord.js mock
    âˆš Client mock exists (3 ms)
    âˆš Client mock has required methods (1 ms)
    âˆš SlashCommandBuilder mock exists

PASS __tests__/unit/input-validator-sanitization.test.js
  InputValidator - Sanitization
    validateAndSanitize
      âˆš should validate and sanitize clean input (3 ms)
      âˆš should sanitize HTML content (1 ms)
      âˆš should reject dangerous content (1 ms)
      âˆš should handle empty input
      âˆš should handle null input (1 ms)
      âˆš should validate different input types (1 ms)
    validation patterns
      âˆš should have correct validation patterns (1 ms)
      âˆš should have correct validation limits (1 ms)
      âˆš should have dangerous patterns defined (1 ms)

PASS __tests__/unit/utils/input-validator.test.js
  InputValidator
    validateTimeString
      âˆš should return valid for normal time strings (3 ms)
      âˆš should return invalid for empty strings (1 ms)
      âˆš should return invalid for too long strings
      âˆš should return invalid for dangerous patterns (1 ms)
    validateReminderMessage
      âˆš should return valid for normal messages
      âˆš should return invalid for empty messages (1 ms)
      âˆš should return invalid for too long messages (1 ms)
      âˆš should return invalid for dangerous patterns

PASS __tests__/unit/bot-error-handling.test.js
  Bot Error Handling
    âˆš should log uncaught exceptions (3 ms)
    âˆš should log unhandled promise rejections (1 ms)

PASS __tests__/unit/commands/reminder.test.js
  Reminder Commands
    /remind command
      âˆš should handle /remind command successfully (3 ms)
      âˆš should handle /remind command with invalid message
      âˆš should handle /remind command API error (1 ms)
    /reminders command
      âˆš should handle /reminders command successfully with reminders (1 ms)
      âˆš should handle /reminders command with no reminders (1 ms)
      âˆš should handle /reminders command API error
    /cancelreminder command
      âˆš should handle /cancelreminder command successfully (1 ms)
      âˆš should handle /cancelreminder command with non-existent reminder (1 ms)
      âˆš should handle /cancelreminder command API error (1 ms)

PASS __tests__/unit/error-handler-classification.test.js
  ErrorHandler - Error Classification
    Error Type Classification
      âˆš should classify network timeout errors (2 ms)
      âˆš should classify ECONNRESET errors as network errors
      âˆš should classify 429 status as rate limit error
      âˆš should classify 401/403 as authentication errors (1 ms)
      âˆš should classify file permission errors
      âˆš should classify file not found errors (1 ms)
      âˆš should classify memory errors
      âˆš should classify config errors (1 ms)
    API Error Handling
      âˆš should handle API errors with response data
      âˆš should handle API errors without response
    Error Creation
      âˆš should create standardized errors (1 ms)
      âˆš should create errors with default values

PASS __tests__/unit/bot-init.test.js
  Bot Initialization
    âˆš should create a Discord client and log in (336 ms)
    âˆš should register event handlers (31 ms)

PASS __tests__/unit/logger-data-handling.test.js
  Logger - Data Logging and Error Handling
    Data Logging
      âˆš should log data object when provided to info (4 ms)
      âˆš should log data object when provided to warn (1 ms)
      âˆš should log data object when provided to debug (2 ms)
      âˆš should handle null data gracefully (3 ms)
      âˆš should handle undefined data gracefully (3 ms)
    Error Method Context
      âˆš should handle error method with request details (3 ms)
      âˆš should handle errors without response (1 ms)
      âˆš should handle errors without stack trace (2 ms)
    Test Environment Handling
      âˆš should not write to file in test environment (2 ms)
      âˆš should not create directory in test environment (1 ms)

  console.error
    [2025-11-24T19:28:59.541Z] [ERROR] Error in processAIResponse:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:82:5)

  console.error
    Error: API Error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:82:5)

  console.error
    Stack: Error: API Error
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\chat-service-advanced.test.js:77:19)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:82:5)

  console.error
    [2025-11-24T19:28:59.577Z] [ERROR] Error in chat generation:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at handleError (src/services/chat.js:449:38)
      at handleChatMessage (src/services/chat.js:410:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:82:5)

  console.error
    Error: API Error

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at handleError (src/services/chat.js:449:38)
      at handleChatMessage (src/services/chat.js:410:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:82:5)

  console.error
    Stack: Error: API Error
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\chat-service-advanced.test.js:77:19)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at handleError (src/services/chat.js:449:38)
      at handleChatMessage (src/services/chat.js:410:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:82:5)

  console.error
    [2025-11-24T19:28:59.605Z] [ERROR] Error in processAIResponse:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:184:5)

  console.error
    Error: Request timeout

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:184:5)

  console.error
    Stack: Error: Request timeout
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\chat-service-advanced.test.js:181:62)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:184:5)

  console.error
    [2025-11-24T19:28:59.614Z] [ERROR] Error in chat generation:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at handleError (src/services/chat.js:449:38)
      at handleChatMessage (src/services/chat.js:410:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:184:5)

  console.error
    Error: Request timeout

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at handleError (src/services/chat.js:449:38)
      at handleChatMessage (src/services/chat.js:410:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:184:5)

  console.error
    Stack: Error: Request timeout
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\chat-service-advanced.test.js:181:62)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at Function.error [as handleError] (src/utils/error-handler.js:207:14)
      at handleError (src/services/chat.js:449:38)
      at handleChatMessage (src/services/chat.js:410:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:184:5)

  console.error
    [2025-11-24T19:28:59.621Z] [ERROR] Error in processAIResponse:

    [0m [90m 184 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mERROR[39m) {
     [90m 185 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'ERROR'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 186 |[39m       console[33m.[39merror(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [90m// Write to file[39m
     [90m 189 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.error (src/utils/logger.js:186:15)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:203:5)

  console.error
    Error: Rate limit exceeded

    [0m [90m 218 |[39m             stack[33m:[39m error[33m.[39mstack[33m,[39m
     [90m 219 |[39m           }[33m;[39m
    [31m[1m>[22m[39m[90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m 222 |[39m         }
     [90m 223 |[39m[0m

      at Logger.error (src/utils/logger.js:220:19)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:203:5)

  console.error
    Stack: Error: Rate limit exceeded
        at Object.<anonymous> (C:\Users\chris\aszune-ai\aszune-ai-bot\__tests__\unit\chat-service-advanced.test.js:198:28)
        at Promise.then.completed (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:316:40)
        at _runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:121:9)
        at run (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (C:\Users\chris\aszune-ai\aszune-ai-bot\node_modules\jest-runner\build\runTest.js:444:34)

    [0m [90m 219 |[39m           }[33m;[39m
     [90m 220 |[39m           console[33m.[39merror([32m'Error:'[39m[33m,[39m error[33m.[39mmessage [33m||[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 221 |[39m           [36mif[39m (error[33m.[39mstack) console[33m.[39merror([32m'Stack:'[39m[33m,[39m error[33m.[39mstack)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 222 |[39m         }
     [90m 223 |[39m
     [90m 224 |[39m         [90m// Write error details to file[39m[0m

      at Logger.error (src/utils/logger.js:221:36)
      at error (src/services/chat.js:541:12)
      at handleChatMessage (src/services/chat.js:395:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:203:5)

  console.warn
    [2025-11-24T19:28:59.626Z] [WARN] Rate limit error in chat generation:

    [0m [90m 167 |[39m     [36mif[39m ([36mthis[39m[33m.[39m_getLogLevel() [33m<=[39m [36mthis[39m[33m.[39mlevels[33m.[39m[33mWARN[39m) {
     [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m[0m

      at Logger.warn (src/utils/logger.js:169:15)
      at Function.warn [as handleError] (src/utils/error-handler.js:203:14)
      at handleError (src/services/chat.js:449:38)
      at handleChatMessage (src/services/chat.js:410:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:203:5)

  console.warn
    {
      type: 'RATE_LIMIT_ERROR',
      context: 'chat generation',
      message: 'Rate limit exceeded',
      stack: 'Error: Rate limit exceeded\n' +
        '    at Object.<anonymous> (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\__tests__\\unit\\chat-service-advanced.test.js:198:28)\n' +
        '    at Promise.then.completed (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\node_modules\\jest-circus\\build\\utils.js:298:28)\n' +
        '    at new Promise (<anonymous>)\n' +
        '    at callAsyncCircusFn (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\node_modules\\jest-circus\\build\\utils.js:231:10)\n' +
        '    at _callCircusTest (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\node_modules\\jest-circus\\build\\run.js:316:40)\n' +
        '    at _runTest (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\node_modules\\jest-circus\\build\\run.js:252:3)\n' +
        '    at _runTestsForDescribeBlock (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\node_modules\\jest-circus\\build\\run.js:126:9)\n' +
        '    at _runTestsForDescribeBlock (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\node_modules\\jest-circus\\build\\run.js:121:9)\n' +
        '    at run (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\node_modules\\jest-circus\\build\\run.js:71:3)\n' +
        '    at runAndTransformResultsToJestFormat (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n' +
        '    at jestAdapter (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n' +
        '    at runTestInternal (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n' +
        '    at runTest (C:\\Users\\chris\\aszune-ai\\aszune-ai-bot\\node_modules\\jest-runner\\build\\runTest.js:444:34)',
      code: undefined,
      statusCode: 429,
      timestamp: '2025-11-24T19:28:59.626Z',
      userId: 'unknown',
      messageLength: 5,
      sanitizedContent: 0
    }

    [0m [90m 168 |[39m       [36mconst[39m formattedMessage [33m=[39m [36mthis[39m[33m.[39m_formatMessage([32m'WARN'[39m[33m,[39m message)[33m;[39m
     [90m 169 |[39m       console[33m.[39mwarn(formattedMessage)[33m;[39m
    [31m[1m>[22m[39m[90m 170 |[39m       [36mif[39m (data) console[33m.[39mwarn(data)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 171 |[39m
     [90m 172 |[39m       [90m// Write to file[39m
     [90m 173 |[39m       [36mthis[39m[33m.[39m_writeToFile(formattedMessage)[33m;[39m[0m

      at Logger.warn (src/utils/logger.js:170:25)
      at Function.warn [as handleError] (src/utils/error-handler.js:203:14)
      at handleError (src/services/chat.js:449:38)
      at handleChatMessage (src/services/chat.js:410:5)
      at Object.<anonymous> (__tests__/unit/chat-service-advanced.test.js:203:5)

PASS __tests__/unit/chat-service-advanced.test.js
  Chat Service - Advanced
    âˆš should handle AI response generation errors (49 ms)
    âˆš should add emojis to responses when not in low CPU mode (3 ms)
    âˆš should handle long responses with chunking (1 ms)
    âˆš should handle special characters in messages (1 ms)
    âˆš should handle multiline messages (2 ms)
    âˆš should handle messages with URLs (2 ms)
    âˆš should handle messages with emojis (2 ms)
    âˆš should handle empty conversation history (2 ms)
    âˆš should handle conversation history with multiple messages (1 ms)
    âˆš should handle network timeouts gracefully (16 ms)
    âˆš should handle rate limit errors from API (10 ms)

PASS __tests__/integration/bot-features.test.js
  Bot Integration - Features
    âˆš adds emoji reactions for keywords (32 ms)
    âˆš adds multiple emoji reactions for multiple keywords (24 ms)
    âˆš rate limits user messages (26 ms)
    âˆš handles API error when replying (24 ms)
    âˆš handles API error when summarising (23 ms)
    âˆš handles empty message gracefully (23 ms)
    âˆš truncates very long conversation history (23 ms)
    âˆš handles missing environment variables gracefully (30 ms)

PASS __tests__/unit/input-validator-validation.test.js
  InputValidator - General Validation
    validateInput
      âˆš should validate text input correctly (3 ms)
      âˆš should reject inputs that exceed length limits (1 ms)
      âˆš should reject inputs with dangerous patterns (1 ms)
      âˆš should validate email format (1 ms)
      âˆš should validate URL format (1 ms)
    sanitizeInput
      âˆš should sanitize HTML content
      âˆš should remove dangerous scripts (1 ms)
      âˆš should preserve safe content (1 ms)

PASS __tests__/unit/logger-critical-coverage.test.js
  Logger - Critical Coverage Enhancement
    Log Level Filtering
      âˆš should skip debug logs when log level is INFO (4 ms)
      âˆš should skip info logs when log level is WARN (4 ms)
      âˆš should skip warn logs when log level is ERROR (2 ms)
      âˆš should process all log levels when set to DEBUG (3 ms)
      âˆš should handle invalid log level gracefully (2 ms)
    File Write Error Handling
      âˆš should handle file write errors gracefully (2 ms)
      âˆš should continue logging to console when file write fails (2 ms)
      âˆš should handle directory creation failure (2 ms)
    Log Rotation
      âˆš should rotate logs when file size exceeds limit (2 ms)
      âˆš should handle stat errors during rotation check (3 ms)
      âˆš should handle readdir errors during cleanup (2 ms)
      âˆš should handle unlink errors during log cleanup (2 ms)
      âˆš should not rotate when file size is under limit (3 ms)
      âˆš should handle non-existent log file during rotation check (1 ms)
      âˆš should use custom log size from environment variable (2 ms)
      âˆš should use default size when custom size is invalid (1 ms)
    Data Logging
      âˆš should log data object when provided to info (2 ms)
      âˆš should log data object when provided to warn (3 ms)
      âˆš should log data object when provided to debug (3 ms)
      âˆš should handle null data gracefully (2 ms)
      âˆš should handle undefined data gracefully (1 ms)
      âˆš should handle circular reference data gracefully (2 ms)
    Error Method Context
      âˆš should handle error method with request details (2 ms)
      âˆš should handle errors without response (2 ms)
      âˆš should handle errors without stack trace (3 ms)
      âˆš should handle simple data objects as errors (3 ms)
      âˆš should handle general errors with stack traces (21 ms)
    Message Formatting Edge Cases
      âˆš should handle very long messages (2 ms)
      âˆš should handle messages with special characters (2 ms)
      âˆš should handle empty string messages (2 ms)
      âˆš should handle numeric messages (2 ms)
    Test Environment Handling
      âˆš should not write to file in test environment (2 ms)
      âˆš should not create directory in test environment (1 ms)

PASS __tests__/unit/error-handler-critical-coverage.test.js
  ErrorHandler - Critical Coverage Enhancement
    Error Type Classification
      âˆš should classify network timeout errors (3 ms)
      âˆš should classify ECONNRESET errors as network errors (1 ms)
      âˆš should classify ENOTFOUND errors as network errors
      âˆš should classify 429 status as rate limit error (1 ms)
      âˆš should classify 401/403 as authentication errors
      âˆš should classify 403 as authentication error (1 ms)
      âˆš should classify validation errors
      âˆš should classify file permission errors (1 ms)
      âˆš should classify file not found errors
      âˆš should classify memory errors (1 ms)
      âˆš should classify config errors (1 ms)
    Context Information Processing
      âˆš should include all context information in result (20 ms)
      âˆš should handle missing context gracefully
      âˆš should handle null context (1 ms)
      âˆš should handle empty context object (1 ms)
    Error Message Processing
      âˆš should extract message from error objects
      âˆš should handle errors without message property (1 ms)
      âˆš should handle string errors
      âˆš should handle null or undefined errors safely (1 ms)
    Status Code and Error Code Processing
      âˆš should preserve HTTP status codes (1 ms)
      âˆš should preserve error codes
      âˆš should handle errors with both status and statusCode
      âˆš should handle 5xx errors as network errors
    API Error Handling
      âˆš should handle API errors with response data (1 ms)
      âˆš should handle API errors without response
    File Error Handling
      âˆš should handle file operation errors (1 ms)
    Validation Error Handling
      âˆš should handle validation errors with field info (1 ms)
      âˆš should truncate long values
    Error Creation
      âˆš should create standardized errors (1 ms)
      âˆš should create errors with default values (1 ms)
    Retry Logic
      âˆš should retry retryable errors (42 ms)
      âˆš should not retry non-retryable errors (1 ms)
      âˆš should exhaust retries for persistent errors (50 ms)
    Special Edge Cases
      âˆš should handle very large error objects (1 ms)
      âˆš should handle circular reference errors (1 ms)
      âˆš should handle errors with getters that throw (1 ms)

PASS __tests__/unit/testUtils.test.js
  Test Utilities
    createMockMessage
      âˆš creates a default mock message with expected properties (2 ms)
      âˆš allows custom options (1 ms)
    createMockInteraction
      âˆš creates a default mock interaction with expected properties (1 ms)
      âˆš allows custom options
    resetMocks
      âˆš resets all mocks

PASS __tests__/unit/emoji.test.js
  appendEmoji
    âˆš adds the correct emoji for known keywords (2 ms)
    âˆš does not modify the text if no keyword is present
    âˆš is case-insensitive
    âˆš can add multiple emojis (1 ms)
    âˆš does not add emoji for keywords inside other words
    âˆš adds all matching emojis in correct order (1 ms)
    âˆš handles empty string
    âˆš handles string with only emojis as keywords (1 ms)

PASS __tests__/unit/url-formatter-youtube.test.js
  URL Formatter - YouTube
    formatYouTubeLinks
      âˆš should format YouTube URLs (2 ms)
      âˆš should format YouTube short URLs
      âˆš should handle text without YouTube URLs
      âˆš should handle multiple YouTube URLs
    fixLinkFormatting
      âˆš should fix malformed markdown links (1 ms)
      âˆš should handle properly formatted links (1 ms)
      âˆš should handle text without links
      âˆš should fix multiple malformed links
    formatAllUrls
      âˆš should format all types of URLs (2 ms)
      âˆš should handle text without URLs (1 ms)
      âˆš should handle mixed content (1 ms)
    Error handling
      âˆš should handle null input (1 ms)
      âˆš should handle undefined input
      âˆš should handle empty string input
      âˆš should handle non-string input (1 ms)

PASS __tests__/unit/message-chunker-advanced.test.js
  Message Chunker - Advanced
    âˆš should not cut off sentences at chunk boundaries (3 ms)
    âˆš should handle messages with special characters (1 ms)
    âˆš should handle messages with unicode characters (1 ms)
    âˆš should handle messages with URLs (1 ms)
    âˆš should handle messages with markdown formatting (1 ms)
    âˆš should handle messages with line breaks
    âˆš should handle very long single word (1 ms)
    âˆš should handle mixed content types
    âˆš should maintain chunk order (1 ms)
    âˆš should handle edge case with exact chunk size (1 ms)

PASS __tests__/unit/storage.test.js
  DataStorage
    init
      âˆš should create data directory if it does not exist (3 ms)
      âˆš should not create directory if already initialized (1 ms)
      âˆš should throw and log error if mkdir fails (12 ms)
    saveUserStats
      âˆš should save user stats to file (1 ms)
      âˆš should log error if writeFile fails (1 ms)
    loadUserStats
      âˆš should load user stats from file (1 ms)
      âˆš should return empty object if file does not exist (1 ms)
      âˆš should return empty object and log error if readFile fails for other reasons (1 ms)
      âˆš should return empty object and log warning if JSON parsing fails (1 ms)

PASS __tests__/unit/debouncer.test.js
  Debouncer
    debounce
      âˆš should delay function execution (3 ms)
      âˆš should only execute once for multiple rapid calls (1 ms)
      âˆš should reset the timer when called again during wait time (1 ms)
      âˆš should pass arguments to the debounced function

PASS __tests__/unit/utils/security-monitor-threats.test.js
  SecurityMonitor - Threat Analysis
    analyzeSecurityThreats
      âˆš should analyze low-risk message (3 ms)
      âˆš should analyze high-risk message with XSS (2 ms)
      âˆš should analyze medium-risk message with suspicious patterns (1 ms)
      âˆš should handle message without content
      âˆš should handle malformed message object (17 ms)
    logSecurityEvent
      âˆš should log low-level security event (1 ms)
      âˆš should log high-level security event (1 ms)
      âˆš should handle missing event details
      âˆš should throw error for invalid event (1 ms)
      âˆš should throw error for event without type
      âˆš should throw error for event without level (1 ms)

PASS __tests__/unit/pi-detector-detection.test.js
  Pi Detector - Detection
    detectPiModel
      âˆš should detect Raspberry Pi 4 (2 ms)
      âˆš should detect Raspberry Pi 3 (1 ms)
      âˆš should detect Raspberry Pi 5 (3 ms)
      âˆš should handle CPU frequency detection
      âˆš should handle temperature reading failure (1 ms)
      âˆš should handle non-Pi systems (1 ms)
      âˆš should handle non-Linux systems (1 ms)
      âˆš should handle errors gracefully (1 ms)

PASS __tests__/unit/config-branch-coverage.test.js
  Config - Branch Coverage
    Environment variable handling
      âˆš should handle missing DISCORD_BOT_TOKEN (23 ms)
      âˆš should handle missing PERPLEXITY_API_KEY (5 ms)
      âˆš should handle different NODE_ENV values (3 ms)
      âˆš should handle different LOG_LEVEL values (4 ms)
      âˆš should handle PI_OPTIMIZATIONS_ENABLED environment variable (3 ms)
    Configuration object structure
      âˆš should have all required configuration sections (4 ms)
      âˆš should handle nested configuration objects (4 ms)
    Edge cases
      âˆš should handle empty string environment variables (4 ms)
      âˆš should handle undefined environment variables (4 ms)
      âˆš should handle null environment variables (5 ms)

PASS __tests__/unit/logger-branch-coverage.test.js
  Logger - Branch Coverage Tests
    âˆš skips debug logs when log level is higher (7 ms)
    âˆš skips info logs when log level is higher (3 ms)
    âˆš skips warning logs when log level is higher (3 ms)
    âˆš handles directory creation failure (4 ms)
    âˆš tests log file rotation (4 ms)
    âˆš handles custom log size limit (4 ms)
    âˆš handles file stat errors during log rotation (3 ms)
    âˆš handles request errors in error method (3 ms)
    âˆš handles invalid log levels (4 ms)
    âˆš handles file write errors (3 ms)
    âˆš handles errors during log rotation (3 ms)
    âˆš handles unlink errors during log cleanup (3 ms)

PASS __tests__/unit/utils/resource-optimizer.test.js
  ResourceOptimizer - optimizeForServerCount
    âˆš should optimize for small server count (3 ms)
    âˆš should optimize for medium server count (1 ms)
    âˆš should optimize for large server count (1 ms)
    âˆš should optimize for enterprise server count
    âˆš should apply performance adjustments (1 ms)
    âˆš should handle zero servers gracefully (1 ms)
  ResourceOptimizer - monitorResources
    âˆš should monitor resource status correctly (1 ms)
    âˆš should detect good performance status
    âˆš should detect poor performance status (1 ms)
    âˆš should calculate memory usage correctly
    âˆš should provide appropriate recommendations
    âˆš should include free memory field in monitoring results (1 ms)
    âˆš should include load field in performance monitoring
    âˆš should include optimizationTier field (1 ms)
    âˆš should determine load correctly based on metrics (1 ms)
  ResourceOptimizer - applyDynamicScaling
    âˆš should apply scaling for increasing load (1 ms)
    âˆš should not scale when performance is good
    âˆš should handle missing metrics gracefully (1 ms)
  ResourceOptimizer - generateOptimizationRecommendations
    âˆš should generate recommendations based on analytics and performance (1 ms)
    âˆš should recommend scaling for high server count
    âˆš should recommend performance improvements for slow response times
    âˆš should recommend error investigation for high error rates (1 ms)
    âˆš should handle empty or null inputs gracefully (4 ms)
  ResourceOptimizer - Pi Optimizations
    âˆš should apply Pi-specific optimizations when enabled (1 ms)
    âˆš should monitor resources with Pi constraints (1 ms)
  ResourceOptimizer - Error Handling
    âˆš should handle invalid server counts gracefully
    âˆš should handle invalid metrics gracefully
    âˆš should provide fallback values for missing data (1 ms)
  ResourceOptimizer - Performance
    âˆš should optimize quickly for large datasets (9 ms)
    âˆš should not consume excessive memory during optimization (7 ms)

PASS __tests__/utils/undici-mock-helpers.test.js
  Undici mock helpers
    âˆš should create a success response with expected structure (3 ms)
    âˆš should create an error response with expected structure (1 ms)
    âˆš should use default status code for error responses

PASS __tests__/unit/commands/reminder-id-fix.test.js
  Reminder Command - ID Display Fix
    âˆš should display numeric reminder ID instead of [object Object] (4 ms)
    âˆš should handle reminder creation with correct ID extraction (1 ms)
    âˆš should include all reminder details in success message

PASS __tests__/unit/message-formatter-advanced.test.js
  Message Formatter - Advanced
    createCompactEmbed
      âˆš should return original embed when not in compact mode (3 ms)
      âˆš should create compact embed when in compact mode (1 ms)
      âˆš should handle embeds without fields
      âˆš should handle embeds without description
    formatResponse with special content
      âˆš should handle messages with markdown formatting (1 ms)
      âˆš should handle messages with URLs (1 ms)
      âˆš should handle messages with emojis (1 ms)
      âˆš should handle messages with unicode characters
      âˆš should handle messages with special characters
      âˆš should handle messages with code blocks (1 ms)
      âˆš should handle messages with quotes (1 ms)
      âˆš should handle messages with spoilers (1 ms)
    edge cases
      âˆš should handle very long single word
      âˆš should handle messages with mixed content types
      âˆš should handle messages with carriage returns

--------------------------------|---------|----------|---------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
File                            | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
--------------------------------|---------|----------|---------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
All files                       |   69.55 |    82.92 |   69.64 |   69.55 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 src                            |   83.64 |    88.05 |     100 |   83.64 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  index.js                      |   83.64 |    88.05 |     100 |   83.64 | 13-16,45-70,90-91,174-175,183-184,199,203,246-247,257-259,323-329,334-340,373-380,406-409                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 src/commands                   |   73.21 |    75.34 |   69.44 |   73.21 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  index.js                      |   90.01 |    80.64 |   90.47 |   90.01 | 31-32,34-35,37-38,95-96,103-104,296-298,416-418,423-424,426-427,580-581,596-597,629-641,650-652,668-678,724-725,870-912,957,960                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  reminder.js                   |   27.82 |    45.45 |      40 |   27.82 | 10-11,14-15,17-32,45,48,51,69-83,88-89,99-100,103-115,144-155,157-207,209-223,225-261,263-287,289-300,302-340,343-358                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 src/config                     |   98.23 |       90 |     100 |   98.23 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  config.js                     |   98.23 |       90 |     100 |   98.23 | 34-35,37-38                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 src/services                   |   51.43 |    82.78 |   51.14 |   51.43 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  api-client.js                 |   90.45 |    77.27 |    87.5 |   90.45 | 39-41,75-76,80-81,91-96,135-139,145,187-188                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  cache-manager.js              |    57.6 |    58.33 |    37.5 |    57.6 | 42-49,63-70,72-74,95-101,109-120,129-141,148-157,163-173,180-186,204-205,239-263,270-281,289-296,302-306                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  chat.js                       |   83.63 |    76.85 |   88.88 |   83.63 | 36-38,44-52,118-120,124-125,157-159,234-264,297-299,334-348,366-368,422-431,476-478,489-491,516-517                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  database.js                   |   85.67 |    84.91 |   85.91 |   85.67 | 25-27,342-343,439-445,448-458,530-533,632-634,653-656,673-675,692-694,751-753,757-768,785-791,793-796,800-825,839-842,856-859,874-877,888-893,904-907,921-924,945-948,983-986,1027-1039,1046-1058,1066-1067                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  network-detector.js           |       0 |        0 |       0 |       0 | 1-312                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  perplexity-secure.js          |   79.75 |    83.61 |   76.47 |   79.75 | 29-39,140-145,153-158,184-191,228-229,259-263,270-274,307-308,473,501,503,578-582,611-612,631-632,634-638,640-645,647-654,667-669,679-680,780-802,858-868,871-876,890-907,916-923,934-938,962-964,989-1022,1053-1091,1135-1137                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  reminder-service.js           |   97.51 |    92.85 |     100 |   97.51 | 112,116-118,203-204,268                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  response-processor.js         |   90.15 |    82.05 |     100 |   90.15 | 24-25,54-55,59-60,71-77,82-87                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  storage.js                    |   95.32 |    90.47 |     100 |   95.32 | 65-67,96-97                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  throttling-service.js         |   71.42 |      100 |      40 |   71.42 | 36-48,55-56,63-67                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  web-dashboard.js              |   18.98 |      100 |       0 |   18.98 | 14-30,37-55,62-67,74-86,89-124,131-164,171-179,185-213,220-222,231-261,267-285,291-323,333-344,353-367,375-376,382-402,408-448,455-485,492-495,502-504,511-538,545-565,572-581,588-591,598-601,608-623,630-659,666-685,693-723,732-758,767-777,787-819,829-879,889-904,911-914,921-938,945-967,974-996,1003-1020,1027-1054,1061-1099,1106-1109,1116-1131,1138-1153,1160-1175,1183-1200,1208-1238,1246-1247,1254-1258,1265-1282,1289-1314,1321-1340,1347-1364,1371-1382,1389-1406,1413-1427,1434-1440,1447-1459,1466-1622,1628-1648,1654-1703,1706-1741,1744-1766,1769-1783,1786-1792,1798-1846,1852-1859,1862-1929,1932-2065,2071-2118,2121-2145,2148-2182,2185-2215,2218-2246,2252-2289,2296-2312,2315-2361,2368-2378,2381-2414,2417-2427,2430-2444,2447-2493,2500-2512,2515-2563,2569-2580,2587-2593,2600-2657,2664-2684,2691-2721,2728-2740,2747-2793,2796-2838,2845-2846,2853-2879,2886-2933,2940-2941,2949-2958,2966-2971,2978-3015,3022-3052,3061-3068,3077-3096,3106-3159,3168-3183,3190-3222,3229-3249,3256-3265,3272-3281,3288-3292,3299-3304,3311-3318 
 src/utils                      |   83.01 |    84.11 |   82.05 |   83.01 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  cache-pruner.js               |   74.35 |    72.72 |   85.71 |   74.35 | 25-26,39-46,113-116,135-136,146-179                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  connection-throttler.js       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  conversation.js               |   89.01 |    85.24 |     100 |   89.01 | 31-44,53,79-80,84-90,100-106,257-259,279-280,282-283                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  dashboard-socket-handlers.js  |       0 |        0 |       0 |       0 | 1-149                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  debouncer.js                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  discord-analytics.js          |   59.76 |    88.05 |   39.47 |   59.76 | 10-19,152-153,183-184,356-357,359-360,374-393,402-422,429-439,446-466,473-493,500-513,522-549,558-572,581-607,616-637,646-675,682,686,690,694,698-710,713-728,731-742,745-753,756-757,760-762,765-768                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  emoji.js                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  enhanced-cache.js             |   81.39 |    76.54 |   72.41 |   81.39 | 72-73,80-81,137-138,170-173,223-229,250-252,265-266,275-290,363,374-375,377-378,381-382,420-432,438-459,465-472,508-517,524-526,533-538                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  error-handler.js              |     100 |    94.68 |     100 |     100 | 163,215,230,272-273                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  input-validator.js            |   75.85 |    69.76 |   84.61 |   75.85 | 61-62,108-109,121-122,135-139,151-152,175-179,195-199,213-214,219-220,258-262,273-287,295-308,314-329,332-344,357-361,366-367,371-375,385-386,391-395,403-404,407-408,411-412,415-416,434-438,452-453,493-494,513-521,550-551,562-584,614-620,629-640,654-660,663-669,692-697,739-743                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  lazy-loader.js                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  logger.js                     |   97.14 |    98.03 |    90.9 |   97.14 | 96-97,238-242                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  memory-monitor.js             |   88.29 |    58.69 |     100 |   88.29 | 14-22,28,31,50-53,57-58,112-113,153-154,182-184                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  message-chunker.js            |   95.06 |    91.26 |   95.23 |   95.06 | 79-80,131-134,174-176,180-181,236-237,295-296,321-322,334-345                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  message-formatter.js          |   91.37 |    82.05 |     100 |   91.37 | 71-75,83-84,90-91,110,126-127,157,167-168                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  natural-language-reminder.js  |   92.91 |    80.55 |     100 |   92.91 | 169-171,188-190,200-205,247-254,276-282                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  performance-dashboard.js      |    90.4 |    84.72 |   97.14 |    90.4 | 13-20,36-50,113-117,147-155,557-560,576-577,614-619,622-627,634-639,675-678,681-682,716-717,720-721,737-738,741-742,757-758,776-777,781-782                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  performance-monitor.js        |   72.85 |    57.57 |      60 |   72.85 | 22-23,30-31,40-41,49-51,60-62,104-105,113-115,123-135,156-164,166-169,184-206,220-224,243-246,254-257                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  performance-tracker.js        |   96.15 |      100 |   85.71 |   96.15 | 8-14                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  pi-detector.js                |   97.05 |     88.6 |     100 |   97.05 | 95-97,406-414,501-503                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  resource-optimizer.js         |   94.67 |    86.46 |   96.77 |   94.67 | 10-22,98,269-270,290,436,450-451,462-463,472-473,485-487,574-577                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  security-monitor.js           |   93.72 |    89.47 |     100 |   93.72 | 43-45,167-169,172-174,177-179,182-184,201-202                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  testUtils.js                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  time-parser.js                |   40.18 |       50 |    7.14 |   40.18 | 5-7,40-84,93-96,105-108,117-131,139-161,169-177,185-193,201-209,222-241,244-251,259-260,267-268,277-315                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 src/utils/message-chunking     |   78.38 |    75.47 |    85.1 |   78.38 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  chunk-boundary-handler.js     |   77.85 |    64.44 |     100 |   77.85 | 44-52,71-81,88-89,94-95,100-101,106-107,112-113,126-134,167-173,177-183,241-244,279-281,286-291                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  index.js                      |   54.22 |       50 |   33.33 |   54.22 | 50-73,83-93,100-129                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  source-reference-processor.js |   75.57 |       84 |   72.22 |   75.57 | 24-35,42-53,80-85,105-111,148-154,163-166,244-245,254-260,265-273,278-280,295-300                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  url-formatter.js              |   88.46 |    85.29 |     100 |   88.46 | 88-93,137-143,154-159,178-183,296-301,312-314,324-325,341-343,401-406,428-433                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
--------------------------------|---------|----------|---------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Test Suites: 4 skipped, 123 passed, 123 of 127 total
Tests:       10 skipped, 1253 passed, 1263 total
Snapshots:   0 total
Time:        256.924 s
Ran all test suites.
