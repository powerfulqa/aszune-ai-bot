#!/bin/bash
# Restart the Aszune AI Bot
# Usage: npm run restart (recommended - works everywhere)

echo "ğŸ”„ Restarting Aszune AI Bot..."

# Try systemd first (if bot is running as a service)
if command -v systemctl &> /dev/null; then
    if sudo systemctl is-active --quiet aszune-ai-bot 2>/dev/null; then
        echo "ğŸ“‹ Using systemctl to restart service..."
        sudo systemctl restart aszune-ai-bot
        sleep 2
        
        if sudo systemctl is-active --quiet aszune-ai-bot 2>/dev/null; then
            echo "âœ… Bot restarted successfully via systemctl"
            sudo systemctl status aszune-ai-bot --no-pager
        else
            echo "âš ï¸  Service restart command executed"
        fi
        exit 0
    fi
fi

# Fallback: kill existing process and start new one
echo "ğŸš€ Using direct process management..."

# Kill existing node processes running the bot
if pgrep -f "node src/index.js" > /dev/null 2>&1; then
    echo "â¹ï¸  Stopping existing bot process..."
    pkill -f "node src/index.js" || true
    sleep 1
fi

# Start the bot in background
echo "â–¶ï¸  Starting bot..."
nohup npm start > /tmp/bot.log 2>&1 &
sleep 2

# Verify it's running
if pgrep -f "node src/index.js" > /dev/null 2>&1; then
    echo "âœ… Bot started successfully!"
    echo "ğŸ“Š Dashboard: http://localhost:3000"
else
    echo "âŒ Failed to start bot - check logs"
    tail -20 /tmp/bot.log
    exit 1
fi
